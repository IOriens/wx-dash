<!DOCTYPE html><html lang="zh-CN"><head>
  <meta charset="UTF-8">
  <title>live-player</title>
  <link rel="stylesheet" href="../../../../../style.css">
  <link rel="stylesheet" href="../../../../../website.css">
  <style type="text/css">
    body {
      padding: 1em;
    }
  </style>
</head>
<body>
   <div id="docContent"><div class="content custom"><h1 id="live-player"><a href="#live-player" aria-hidden="true" class="header-anchor">#</a> live-player</h1> <blockquote><p>基础库 1.7.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a>。</p></blockquote> <p>实时音视频播放（v2.9.1 起支持<a href="native-component.html#%E5%8E%9F%E7%94%9F%E7%BB%84%E4%BB%B6%E5%90%8C%E5%B1%82%E6%B8%B2%E6%9F%93">同层渲染</a>）。相关api：<a href="../api/media/live/wx.createLivePlayerContext.html">wx.createLivePlayerContext</a></p> <p>暂只针对国内主体如下类目的小程序开放，需要先通过类目审核，再在小程序管理后台，「开发」-「接口设置」中自助开通该组件权限。</p> <div class="table-wrp"><table><thead><tr><th>一级类目/主体类型</th> <th>二级类目</th> <th>小程序内容场景</th></tr></thead> <tbody><tr><td>社交</td> <td>直播</td> <td>涉及娱乐性质，如明星直播、生活趣事直播、宠物直播等。选择该类目后首次提交代码审核，需经当地互联网主管机关审核确认，预计审核时长 7 天左右</td></tr> <tr><td>教育</td> <td>在线视频课程</td> <td>网课、在线培训、讲座等教育类直播</td></tr> <tr><td>医疗</td> <td>互联网医院，公立医疗机构，私立医疗机构</td> <td>问诊、大型健康讲座等直播</td></tr> <tr><td>金融</td> <td>银行、信托、公募基金、私募基金、证券/期货、证券、期货投资咨询、保险、征信业务、新三板信息服务平台、股票信息服务平台（港股/美股）、消费金融</td> <td>金融产品视频客服理赔、金融产品推广直播等</td></tr> <tr><td>汽车</td> <td>汽车预售服务</td> <td>汽车预售、推广直播</td></tr> <tr><td>政府主体帐号</td> <td>/</td> <td>政府相关工作推广直播、领导讲话直播等</td></tr> <tr><td>工具</td> <td>视频客服</td> <td>不涉及以上几类内容的一对一视频客服服务，如企业售后一对一视频服务等</td></tr> <tr><td>IT科技</td> <td>多方通信；音视频设备</td> <td>为多方提供电话会议/视频会议等服务；智能家居场景下控制摄像头</td></tr></tbody></table></div><blockquote><p>在小程序插件中使用需要基础库版本 <a href="../framework/compatibility.html">2.3.0</a> 起。</p></blockquote> <div class="table-wrp"><table><thead><tr><th>属性</th> <th>类型</th> <th>默认值</th> <th>必填</th> <th>说明</th> <th>最低版本</th></tr></thead> <tbody><tr><td>src</td> <td>string</td> <td></td> <td>否</td> <td>音视频地址。目前仅支持 <code>flv</code>, <code>rtmp</code> 格式</td> <td><a href="../framework/compatibility.html">1.7.0</a></td></tr> <tr><td>mode</td> <td>string</td> <td>live</td> <td>否</td> <td>模式</td> <td><a href="../framework/compatibility.html">1.7.0</a></td></tr> <tr><td>autoplay</td> <td>boolean</td> <td>false</td> <td>否</td> <td>自动播放</td> <td><a href="../framework/compatibility.html">1.7.0</a></td></tr> <tr><td>muted</td> <td>boolean</td> <td>false</td> <td>否</td> <td>是否静音</td> <td><a href="../framework/compatibility.html">1.7.0</a></td></tr> <tr><td>orientation</td> <td>string</td> <td>vertical</td> <td>否</td> <td>画面方向</td> <td><a href="../framework/compatibility.html">1.7.0</a></td></tr> <tr><td>object-fit</td> <td>string</td> <td>contain</td> <td>否</td> <td>填充模式，可选值有 <code>contain</code>，<code>fillCrop</code></td> <td><a href="../framework/compatibility.html">1.7.0</a></td></tr> <tr><td>background-mute</td> <td>boolean</td> <td>false</td> <td>否</td> <td>进入后台时是否静音（已废弃，默认退后台静音）</td> <td><a href="../framework/compatibility.html">1.7.0</a></td></tr> <tr><td>min-cache</td> <td>number</td> <td>1</td> <td>否</td> <td>最小缓冲区，单位s（RTC 模式推荐 0.2s）</td> <td><a href="../framework/compatibility.html">1.7.0</a></td></tr> <tr><td>max-cache</td> <td>number</td> <td>3</td> <td>否</td> <td>最大缓冲区，单位s（RTC 模式推荐 0.8s）。缓冲区用来抵抗网络波动，缓冲数据越多，网络抗性越好，但时延越大。</td> <td><a href="../framework/compatibility.html">1.7.0</a></td></tr> <tr><td>sound-mode</td> <td>string</td> <td>speaker</td> <td>否</td> <td>声音输出方式</td> <td><a href="../framework/compatibility.html">1.9.90</a></td></tr> <tr><td>auto-pause-if-navigate</td> <td>boolean</td> <td>true</td> <td>否</td> <td>当跳转到本小程序的其他页面时，是否自动暂停本页面的实时音视频播放</td> <td><a href="../framework/compatibility.html">2.5.0</a></td></tr> <tr><td>auto-pause-if-open-native</td> <td>boolean</td> <td>true</td> <td>否</td> <td>当跳转到其它微信原生页面时，是否自动暂停本页面的实时音视频播放</td> <td><a href="../framework/compatibility.html">2.5.0</a></td></tr> <tr><td>picture-in-picture-mode</td> <td>string/Array</td> <td></td> <td>否</td> <td>设置小窗模式： push, pop，空字符串或通过数组形式设置多种模式（如： ["push", "pop"]）</td> <td><a href="../framework/compatibility.html">2.10.3</a></td></tr> <tr><td>bindstatechange</td> <td>eventhandle</td> <td></td> <td>否</td> <td>播放状态变化事件，detail = {code}</td> <td><a href="../framework/compatibility.html">1.7.0</a></td></tr> <tr><td>bindfullscreenchange</td> <td>eventhandle</td> <td></td> <td>否</td> <td>全屏变化事件，detail = {direction, fullScreen}</td> <td><a href="../framework/compatibility.html">1.7.0</a></td></tr> <tr><td>bindnetstatus</td> <td>eventhandle</td> <td></td> <td>否</td> <td>网络状态通知，detail = {info}</td> <td><a href="../framework/compatibility.html">1.9.0</a></td></tr> <tr><td>bindaudiovolumenotify</td> <td>eventhandler</td> <td></td> <td>否</td> <td>播放音量大小通知，detail = {}</td> <td><a href="../framework/compatibility.html">2.10.0</a></td></tr> <tr><td>bindenterpictureinpicture</td> <td>eventhandler</td> <td></td> <td>否</td> <td>播放器进入小窗</td> <td><a href="../framework/compatibility.html">2.11.0</a></td></tr> <tr><td>bindleavepictureinpicture</td> <td>eventhandler</td> <td></td> <td>否</td> <td>播放器退出小窗</td> <td><a href="../framework/compatibility.html">2.11.0</a></td></tr></tbody></table></div><p><strong>mode 的合法值</strong></p> <div class="table-wrp"><table><thead><tr><th>值</th> <th>说明</th> <th>最低版本</th></tr></thead> <tbody><tr><td>live</td> <td>直播</td> <td></td></tr> <tr><td>RTC</td> <td>实时通话，该模式时延更低</td> <td></td></tr></tbody></table></div><p><strong>orientation 的合法值</strong></p> <div class="table-wrp"><table><thead><tr><th>值</th> <th>说明</th> <th>最低版本</th></tr></thead> <tbody><tr><td>vertical</td> <td>竖直</td> <td></td></tr> <tr><td>horizontal</td> <td>水平</td> <td></td></tr></tbody></table></div><p><strong>object-fit 的合法值</strong></p> <div class="table-wrp"><table><thead><tr><th>值</th> <th>说明</th> <th>最低版本</th></tr></thead> <tbody><tr><td>contain</td> <td>图像长边填满屏幕，短边区域会被填充⿊⾊</td> <td></td></tr> <tr><td>fillCrop</td> <td>图像铺满屏幕，超出显示区域的部分将被截掉</td> <td></td></tr></tbody></table></div><p><strong>sound-mode 的合法值</strong></p> <div class="table-wrp"><table><thead><tr><th>值</th> <th>说明</th> <th>最低版本</th></tr></thead> <tbody><tr><td>speaker</td> <td>扬声器</td> <td></td></tr> <tr><td>ear</td> <td>听筒</td> <td></td></tr></tbody></table></div><p><strong>picture-in-picture-mode 的合法值</strong></p> <div class="table-wrp"><table><thead><tr><th>值</th> <th>说明</th> <th>最低版本</th></tr></thead> <tbody><tr><td>[]</td> <td>取消小窗</td> <td></td></tr> <tr><td>push</td> <td>路由 push 时触发小窗</td> <td></td></tr> <tr><td>pop</td> <td>路由 pop 时触发小窗</td> <td></td></tr></tbody></table></div><h4 id="状态码"><a href="#状态码" aria-hidden="true" class="header-anchor">#</a> 状态码</h4> <div class="table-wrp"><table><thead><tr><th>代码</th> <th>说明</th></tr></thead> <tbody><tr><td>2001</td> <td>已经连接服务器</td></tr> <tr><td>2002</td> <td>已经连接 RTMP 服务器,开始拉流</td></tr> <tr><td>2003</td> <td>网络接收到首个视频数据包(IDR)</td></tr> <tr><td>2004</td> <td>视频播放开始</td></tr> <tr><td>2005</td> <td>视频播放进度</td></tr> <tr><td>2006</td> <td>视频播放结束</td></tr> <tr><td>2007</td> <td>视频播放Loading</td></tr> <tr><td>2008</td> <td>解码器启动</td></tr> <tr><td>2009</td> <td>视频分辨率改变</td></tr> <tr><td>-2301</td> <td>网络断连，且经多次重连抢救无效，更多重试请自行重启播放</td></tr> <tr><td>-2302</td> <td>获取加速拉流地址失败</td></tr> <tr><td>2101</td> <td>当前视频帧解码失败</td></tr> <tr><td>2102</td> <td>当前音频帧解码失败</td></tr> <tr><td>2103</td> <td>网络断连, 已启动自动重连</td></tr> <tr><td>2104</td> <td>网络来包不稳：可能是下行带宽不足，或由于主播端出流不均匀</td></tr> <tr><td>2105</td> <td>当前视频播放出现卡顿</td></tr> <tr><td>2106</td> <td>硬解启动失败，采用软解</td></tr> <tr><td>2107</td> <td>当前视频帧不连续，可能丢帧</td></tr> <tr><td>2108</td> <td>当前流硬解第一个I帧失败，SDK自动切软解</td></tr> <tr><td>3001</td> <td>RTMP -DNS解析失败</td></tr> <tr><td>3002</td> <td>RTMP服务器连接失败</td></tr> <tr><td>3003</td> <td>RTMP服务器握手失败</td></tr> <tr><td>3005</td> <td>RTMP 读/写失败，之后会发起网络重试</td></tr></tbody></table></div><h4 id="网络状态数据"><a href="#网络状态数据" aria-hidden="true" class="header-anchor">#</a> 网络状态数据</h4> <div class="table-wrp"><table><thead><tr><th>键名</th> <th>说明</th></tr></thead> <tbody><tr><td>videoBitrate</td> <td>当前视频编/码器输出的比特率，单位 kbps</td></tr> <tr><td>audioBitrate</td> <td>当前音频编/码器输出的比特率，单位 kbps</td></tr> <tr><td>videoFPS</td> <td>当前视频帧率</td></tr> <tr><td>videoGOP</td> <td>当前视频 GOP,也就是每两个关键帧(I帧)间隔时长，单位 s</td></tr> <tr><td>netSpeed</td> <td>当前的发送/接收速度</td></tr> <tr><td>netJitter</td> <td>网络抖动情况，为 0 时表示没有任何抖动，值越大表明网络抖动越大，网络越不稳定</td></tr> <tr><td>netQualityLevel</td> <td>网络质量：0：未定义 1：最好 2：好 3：一般 4：差 5：很差 6：不可用</td></tr> <tr><td>videoWidth</td> <td>视频画面的宽度</td></tr> <tr><td>videoHeight</td> <td>视频画面的高度</td></tr> <tr><td>videoCache</td> <td>缓冲的视频总时长，单位毫秒</td></tr> <tr><td>audioCache</td> <td>缓冲的音频总时长，单位毫秒</td></tr> <tr><td>vDecCacheSize</td> <td>解码器中缓存的视频帧数 (Android 端硬解码时存在）</td></tr> <tr><td>vSumCacheSize</td> <td>缓冲的总视频帧数，该数值越大，播放延迟越高</td></tr> <tr><td>avPlayInterval</td> <td>音画同步错位时间（播放），单位 ms，此数值越小，音画同步越好</td></tr> <tr><td>avRecvInterval</td> <td>音画同步错位时间（网络），单位 ms，此数值越小，音画同步越好</td></tr> <tr><td>audioCacheThreshold</td> <td>音频缓冲时长阈值，缓冲超过该阈值后，播放器会开始调控延时</td></tr></tbody></table></div><h4 id="小窗特性说明"><a href="#小窗特性说明" aria-hidden="true" class="header-anchor">#</a> 小窗特性说明</h4> <p>live-player 小窗支持以下三种触发模式（在组件上设置 picture-in-picture-mode 属性）：</p> <ol><li><p>push 模式，即从当前页跳转至下一页时出现小窗（页面栈push）</p></li> <li><p>pop 模式，即离开当前页面时触发（页面栈pop）</p></li> <li><p>以上两种路由行为均触发小窗</p></li></ol> <p>此外，小窗还支持以下特性：</p> <ul><li><p>小窗容器尺寸会根据原组件尺寸自动判断</p></li> <li><p>点击小窗，用户会被导航回小窗对应的播放器页面</p></li> <li><p>小窗出现后，用户可点击小窗右上角的关闭按钮或调用 context.exitPictureInPicture() 接口关闭小窗</p></li></ul> <p>当播放器进入小窗模式后，播放器所在页面处于 hide 状态(触发 onHide 生命周期)，该页面不会被销毁。当小窗被关闭时，播放器所在页面会被 unload (触发 onUnload 生命周期)。</p> <h2 id="Bug-Tip"><a href="#Bug-Tip" aria-hidden="true" class="header-anchor">#</a> Bug &amp; Tip</h2> <ol><li><code>tip</code>：<a href="live-player.html">live-player</a> 默认宽度300px、高度225px，可通过wxss设置宽高。</li> <li><code>tip</code>：开发者工具上暂不支持。</li> <li><code>tip</code>: 相关介绍和原理可参考<a href="https://developers.weixin.qq.com/community/develop/doc/000cccb57444107426c621b1756c09" target="_blank" rel="noopener noreferrer">此文章<span></span></a></li></ol> <h2 id="示例代码"><a href="#示例代码" aria-hidden="true" class="header-anchor">#</a> 示例代码</h2> <p><a href="https://developers.weixin.qq.com/s/UzWEzmm763Y4" title="在开发者工具中预览效果" target="_blank" rel="noopener noreferrer">在开发者工具中预览效果<span></span></a></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>live-player</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://domain/pull_stream<span class="token punctuation">"</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>RTC<span class="token punctuation">"</span></span> <span class="token attr-name">autoplay</span> <span class="token attr-name">bindstatechange</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>statechange<span class="token punctuation">"</span></span> <span class="token attr-name">binderror</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 225px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">statechange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'live-player code:'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>code<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">error</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'live-player error:'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>errMsg<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div></div> <!---->    


</body></html>