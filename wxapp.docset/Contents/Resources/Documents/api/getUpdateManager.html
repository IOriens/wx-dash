<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>更新</title>
  <link rel="stylesheet" href="../style.css" />
  <link rel="stylesheet" href="../website.css" />
  <style type="text/css">
    body {
      padding: 1em;
    }
  </style>
</head>
<body>
  
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h3 id="wxgetupdatemanager">wx.getUpdateManager()</h3>
<blockquote>
<p>基础库 1.9.90 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>获取<strong>全局唯一</strong>的版本更新管理器，用于管理小程序更新。</p>
<p>关于小程序的更新机制，可以查看 <a href="../framework/operating-mechanism.html">运行机制</a> 文档。</p>
<h4 id="updatemanager">updateManager</h4>
<p><strong>updateManager 对象的方法列表：</strong></p>
<table>
<thead>
<tr>
<th>方法</th>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>onCheckForUpdate</td>
<td>callback</td>
<td>当向微信后台请求完新版本信息，会进行回调</td>
</tr>
<tr>
<td>onUpdateReady</td>
<td>callback</td>
<td>当新版本下载完成，会进行回调</td>
</tr>
<tr>
<td>onUpdateFailed</td>
<td>callback</td>
<td>当新版本下载失败，会进行回调</td>
</tr>
<tr>
<td>applyUpdate</td>
<td></td>
<td>当新版本下载完成，调用该方法会强制当前小程序应用上新版本并重启</td>
</tr>
</tbody>
</table>
<p><strong>onCheckForUpdate(callback) 回调结果说明：</strong></p>
<table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>hasUpdate</td>
<td>Boolean</td>
<td>是否有新的版本</td>
</tr>
</tbody>
</table>
<p><strong>注：</strong> 检查更新操作由微信在小程序冷启动时自动触发，不需由开发者主动触发，开发者只需监听检查结果即可。</p>
<p><strong>onUpdateReady(callback) 回调结果说明：</strong></p>
<p>当微信检查到小程序有新版本，会主动触发下载操作（无需开发者触发），当下载完成后，会通过 <code>onUpdateReady</code> 告知开发者。</p>
<p><strong>onUpdateFailed(callback) 回调结果说明：</strong></p>
<p>当微信检查到小程序有新版本，会主动触发下载操作（无需开发者触发），如果下载失败（可能是网络原因等），会通过 <code>onUpdateFailed</code> 告知开发者。</p>
<p><strong>applyUpdate() 说明：</strong></p>
<p>当小程序新版本已经下载时（即收到 <code>onUpdateReady</code> 回调），可以通过这个方法强制重启小程序并应用上最新版本。</p>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> updateManager = wx.getUpdateManager()

updateManager.onCheckForUpdate(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
  <span class="hljs-comment">// 请求完新版本信息的回调</span>
  <span class="hljs-built_in">console</span>.log(res.hasUpdate)
})

updateManager.onUpdateReady(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  wx.showModal({
    title: <span class="hljs-string">'更新提示'</span>,
    content: <span class="hljs-string">'新版本已经准备好，是否重启应用？'</span>,
    success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
      <span class="hljs-keyword">if</span> (res.confirm) {
        <span class="hljs-comment">// 新的版本已经下载好，调用 applyUpdate 应用新版本并重启</span>
        updateManager.applyUpdate()
      }
    }
  })

})

updateManager.onUpdateFailed(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// 新的版本下载失败</span>
})
</code></pre>

                                
                                </section>
                            
    </div>
    
</div>

                        
</body>
</html>
