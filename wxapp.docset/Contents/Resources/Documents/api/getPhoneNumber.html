<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>getPhoneNumber</title>
  <link rel="stylesheet" href="../style.css" />
  <link rel="stylesheet" href="../website.css" />
  <style type="text/css">
    body {
      padding: 1em;
    }
  </style>
</head>
<body>
  
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="getphonenumberobject">getPhoneNumber(OBJECT)</h1>
<h2 id="说明">说明</h2>
<p>获取微信用户绑定的手机号，需先调用<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/api/api-login.html?t=2018413#wxloginobject" target="_blank">login</a>接口。</p>
<p>因为需要用户主动触发才能发起获取手机号接口，所以该功能不由 API 来调用，需用 <code><button></code> 组件的点击来触发。 </p>
<p><strong>注意：目前该接口针对非个人开发者，且完成了认证的小程序开放。需谨慎使用，若用户举报较多或被发现在不必要场景下使用，微信有权永久回收该小程序的该接口权限。</strong></p>
<h2 id="使用方法">使用方法</h2>
<p>需要将 <code><button></code> 组件 <code>open-type</code> 的值设置为 <code>getPhoneNumber</code>，当用户点击并同意之后，可以通过 <code>bindgetphonenumber</code> 事件回调获取到微信服务器返回的加密数据， 然后在第三方服务端结合 <code>session_key</code> 以及 <code>app_id</code> 进行解密获取手机号。 </p>
<h2 id="注意">注意</h2>
<p>在回调中调用 <code>wx.login</code> 登录，可能会刷新登录态。此时服务器使用 code 换取的 sessionKey 不是加密时使用的 sessionKey，导致解密失败。建议开发者提前进行 <code>login</code>；或者在回调中先使用 <code>checkSession</code> 进行登录态检查，避免 <code>login</code> 刷新登录态。</p>
<h2 id="例子">例子</h2>
<pre><code class="lang-html"><span class="hljs-tag"><<span class="hljs-name">button</span> <span class="hljs-attr">open-type</span>=<span class="hljs-string">"getPhoneNumber"</span> <span class="hljs-attr">bindgetphonenumber</span>=<span class="hljs-string">"getPhoneNumber"</span>></span> <span class="hljs-tag"></<span class="hljs-name">button</span>></span>
</code></pre>
<pre><code class="lang-javascript">Page({ 
    getPhoneNumber: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{ 
        <span class="hljs-built_in">console</span>.log(e.detail.errMsg) 
        <span class="hljs-built_in">console</span>.log(e.detail.iv) 
        <span class="hljs-built_in">console</span>.log(e.detail.encryptedData) 
    } 
})
</code></pre>
<h2 id="返回参数说明">返回参数说明</h2>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>encryptedData</td>
<td>String</td>
<td>包括敏感数据在内的完整用户信息的加密数据，详细见<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/api/signature.html?t=2018413#%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95" target="_blank">加密数据解密算法</a></td>
</tr>
<tr>
<td>iv</td>
<td>String</td>
<td>加密算法的初始向量，详细见<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/api/signature.html?t=2018413#%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95" target="_blank">加密数据解密算法</a></td>
</tr>
</tbody>
</table>
<p>encryptedData 解密后为以下 json 结构，详见<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/api/signature.html?t=2018413#%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95" target="_blank">加密数据解密算法</a></p>
<pre><code class="lang-json">{
    <span class="hljs-string">"phoneNumber"</span>: <span class="hljs-string">"13580006666"</span>,  
    <span class="hljs-string">"purePhoneNumber"</span>: <span class="hljs-string">"13580006666"</span>, 
    <span class="hljs-string">"countryCode"</span>: <span class="hljs-string">"86"</span>,
    <span class="hljs-string">"watermark"</span>:
    {
        <span class="hljs-string">"appid"</span>:<span class="hljs-string">"APPID"</span>,
        <span class="hljs-string">"timestamp"</span>:TIMESTAMP
    }
}
</code></pre>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>phoneNumber</td>
<td>String</td>
<td>用户绑定的手机号（国外手机号会有区号）</td>
</tr>
<tr>
<td>purePhoneNumber</td>
<td>String</td>
<td>没有区号的手机号</td>
</tr>
<tr>
<td>countryCode</td>
<td>String</td>
<td>区号</td>
</tr>
</tbody>
</table>

                                
                                </section>
                            
    </div>
    
</div>

                        
</body>
</html>
