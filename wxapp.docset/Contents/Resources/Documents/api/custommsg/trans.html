<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>转发消息</title>
  <link rel="stylesheet" href="../../style.css" />
  <link rel="stylesheet" href="../../website.css" />
  <style type="text/css">
    body {
      padding: 1em;
    }
  </style>
</head>
<body>
  
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h3 id="转发消息">转发消息</h3>
<p>如果小程序设置了消息推送，普通微信用户向小程序客服发消息时，微信服务器会先将消息 POST 到开发者填写的 url 上，如果希望将消息转发到网页版客服工具，则需要开发者在响应包中返回 MsgType 为 transfer_customer_service 的消息，微信服务器收到响应后会把当次发送的消息转发至客服系统。</p>
<p>用户被客服接入以后，客服关闭会话以前，处于会话过程中时，用户发送的消息均会被直接转发至客服系统。当会话超过 30 分钟客服没有关闭时，微信服务器会自动停止转发至客服，而将消息恢复发送至开发者填写的 url 上。</p>
<p>用户在等待队列中时，用户发送的消息仍然会被推送至开发者填写的 url 上。</p>
<p>这里特别要注意，只针对微信用户发来的消息才进行转发，而对于其他事件（比如用户从小程序唤起客服会话）都不应该转接，否则客服在客服系统上就会看到一些无意义的消息了。</p>
<p><strong>消息转发到网页版客服工具</strong></p>
<p>开发者只在响应包中返回 MsgType 为 transfer_customer_service 的消息，微信服务器收到响应后就会把当次发送的消息转发至客服系统。 </p>
<pre><code class="lang-xml"> <span class="hljs-tag"><<span class="hljs-name">xml</span>></span>
     <span class="hljs-tag"><<span class="hljs-name">ToUserName</span>></span><![CDATA[touser]]><span class="hljs-tag"></<span class="hljs-name">ToUserName</span>></span>
     <span class="hljs-tag"><<span class="hljs-name">FromUserName</span>></span><![CDATA[fromuser]]><span class="hljs-tag"></<span class="hljs-name">FromUserName</span>></span>
     <span class="hljs-tag"><<span class="hljs-name">CreateTime</span>></span>1399197672<span class="hljs-tag"></<span class="hljs-name">CreateTime</span>></span>
     <span class="hljs-tag"><<span class="hljs-name">MsgType</span>></span><![CDATA[transfer_customer_service]]><span class="hljs-tag"></<span class="hljs-name">MsgType</span>></span>
 <span class="hljs-tag"></<span class="hljs-name">xml</span>></span>
</code></pre>
<p>参数说明</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>是否必须</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>ToUserName</td>
<td>是</td>
<td>接收方帐号（收到的OpenID）</td>
</tr>
<tr>
<td>FromUserName</td>
<td>是</td>
<td>开发者微信号</td>
</tr>
<tr>
<td>CreateTime</td>
<td>是</td>
<td>消息创建时间 （整型）</td>
</tr>
<tr>
<td>MsgType</td>
<td>是</td>
<td>transfer_customer_service</td>
</tr>
</tbody>
</table>

                                
                                </section>
                            
    </div>
    
</div>

                        
</body>
</html>
