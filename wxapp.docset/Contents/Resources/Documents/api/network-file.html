<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>上传、下载</title>
  <link rel="stylesheet" href="../style.css" />
  <link rel="stylesheet" href="../website.css" />
  <style type="text/css">
    body {
      padding: 1em;
    }
  </style>
</head>
<body>
  
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h3 id="wxuploadfileobject">wx.uploadFile(OBJECT)</h3>
<p>将本地资源上传到开发者服务器，客户端发起一个 HTTPS POST 请求，其中 <code>content-type</code> 为 <code>multipart/form-data</code> 。<strong>使用前请先阅读<a href="api-network.html">说明</a></strong>。</p>
<p>如页面通过 <a href="media-picture.html#wxchooseimageobject">wx.chooseImage</a> 等接口获取到一个本地资源的临时文件路径后，可通过此接口将本地资源上传到指定服务器。</p>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>String</td>
<td>是</td>
<td>开发者服务器 url</td>
</tr>
<tr>
<td>filePath</td>
<td>String</td>
<td>是</td>
<td>要上传文件资源的路径</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>是</td>
<td>文件对应的 key , 开发者在服务器端通过这个 key 可以获取到文件二进制内容</td>
</tr>
<tr>
<td>header</td>
<td>Object</td>
<td>否</td>
<td>HTTP 请求 Header, header 中不能设置 Referer</td>
</tr>
<tr>
<td>formData</td>
<td>Object</td>
<td>否</td>
<td>HTTP 请求中其他额外的 form data</td>
</tr>
<tr>
<td>success</td>
<td>Function</td>
<td>否</td>
<td>接口调用成功的回调函数</td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>success返回参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>data</td>
<td>String</td>
<td>开发者服务器返回的数据</td>
</tr>
<tr>
<td>statusCode</td>
<td>Number</td>
<td>开发者服务器返回的 HTTP 状态码</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">wx.chooseImage({
  success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) </span>{
    <span class="hljs-keyword">var</span> tempFilePaths = res.tempFilePaths
    wx.uploadFile({
      url: <span class="hljs-string">'https://example.weixin.qq.com/upload'</span>, <span class="hljs-comment">//仅为示例，非真实的接口地址</span>
      filePath: tempFilePaths[<span class="hljs-number">0</span>],
      name: <span class="hljs-string">'file'</span>,
      formData:{
        <span class="hljs-string">'user'</span>: <span class="hljs-string">'test'</span>
      },
      success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>)</span>{
        <span class="hljs-keyword">var</span> data = res.data
        <span class="hljs-comment">//do something</span>
      }
    })
  }
})
</code></pre>
<p><strong>返回值：</strong></p>
<blockquote>
<p>基础库 1.4.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>返回一个 <code>uploadTask</code> 对象，通过 <code>uploadTask</code>，可监听上传进度变化事件，以及取消上传任务。</p>
<h4 id="uploadtask">uploadTask</h4>
<p><strong>uploadTask 对象的方法列表：</strong></p>
<table>
<thead>
<tr>
<th>方法</th>
<th>参数</th>
<th>说明</th>
<th>最低版本</th>
</tr>
</thead>
<tbody>
<tr>
<td>onProgressUpdate</td>
<td>callback</td>
<td>监听上传进度变化</td>
<td><a href="../framework/compatibility.html" title="基础库 1.4.0 开始支持，低版本需做兼容处理。">1.4.0</a></td>
</tr>
<tr>
<td>abort</td>
<td></td>
<td>中断上传任务</td>
<td><a href="../framework/compatibility.html" title="基础库 1.4.0 开始支持，低版本需做兼容处理。">1.4.0</a></td>
</tr>
</tbody>
</table>
<p><strong>onProgressUpdate 返回参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>progress</td>
<td>Number</td>
<td>上传进度百分比</td>
</tr>
<tr>
<td>totalBytesSent</td>
<td>Number</td>
<td>已经上传的数据长度，单位 Bytes</td>
</tr>
<tr>
<td>totalBytesExpectedToSend</td>
<td>Number</td>
<td>预期需要上传的数据总长度，单位 Bytes</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> uploadTask = wx.uploadFile({
    url: <span class="hljs-string">'http://example.weixin.qq.com/upload'</span>, <span class="hljs-comment">//仅为示例，非真实的接口地址</span>
    filePath: tempFilePaths[<span class="hljs-number">0</span>],
    name: <span class="hljs-string">'file'</span>,
    formData:{
        <span class="hljs-string">'user'</span>: <span class="hljs-string">'test'</span>
    },
    success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>)</span>{
        <span class="hljs-keyword">var</span> data = res.data
        <span class="hljs-comment">//do something</span>
    }
})

uploadTask.onProgressUpdate((res) => {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'上传进度'</span>, res.progress)
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'已经上传的数据长度'</span>, res.totalBytesSent)
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'预期需要上传的数据总长度'</span>, res.totalBytesExpectedToSend)
})

uploadTask.abort() <span class="hljs-comment">// 取消上传任务</span>
</code></pre>
<h3 id="wxdownloadfileobject">wx.downloadFile(OBJECT)</h3>
<p>下载文件资源到本地，客户端直接发起一个 HTTP GET 请求，返回文件的本地临时路径。<strong>使用前请先阅读<a href="api-network.html">说明</a></strong>。</p>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>必填</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>String</td>
<td>是</td>
<td>下载资源的 url</td>
</tr>
<tr>
<td>header</td>
<td>Object</td>
<td>否</td>
<td>HTTP 请求 Header，header 中不能设置 Referer</td>
</tr>
<tr>
<td>success</td>
<td>Function</td>
<td>否</td>
<td>下载成功后以 tempFilePath 的形式传给页面，res = {tempFilePath: '文件的临时路径'}</td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>注：文件的临时路径，在小程序本次启动期间可以正常使用，如需持久保存，需在主动调用 <a href="file.html">wx.saveFile</a>，才能在小程序下次启动时访问得到。</strong></p>
<p><strong>success返回参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>tempFilePath</td>
<td>String</td>
<td>临时文件路径，下载后的文件会存储到一个临时文件</td>
</tr>
<tr>
<td>statusCode</td>
<td>Number</td>
<td>开发者服务器返回的 HTTP 状态码</td>
</tr>
</tbody>
</table>
<p><strong>示例代码:</strong></p>
<pre><code class="lang-javascript">wx.downloadFile({
  url: <span class="hljs-string">'https://example.com/audio/123'</span>, <span class="hljs-comment">//仅为示例，并非真实的资源</span>
  success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) </span>{
    <span class="hljs-comment">// 只要服务器有响应数据，就会把响应内容写入文件并进入 success 回调，业务需要自行判断是否下载到了想要的内容</span>
    <span class="hljs-keyword">if</span> (res.statusCode === <span class="hljs-number">200</span>) {
        wx.playVoice({
          filePath: res.tempFilePath
        })
    }
  }
})
</code></pre>
<p><strong>返回值：</strong></p>
<blockquote>
<p>基础库 1.4.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>返回一个 <code>downloadTask</code> 对象，通过 <code>downloadTask</code>，可监听下载进度变化事件，以及取消下载任务。</p>
<h4 id="downloadtask">downloadTask</h4>
<p><strong>downloadTask 对象的方法列表：</strong></p>
<table>
<thead>
<tr>
<th>方法</th>
<th>参数</th>
<th>说明</th>
<th>最低版本</th>
</tr>
</thead>
<tbody>
<tr>
<td>onProgressUpdate</td>
<td>callback</td>
<td>监听下载进度变化</td>
<td><a href="../framework/compatibility.html" title="基础库 1.4.0 开始支持，低版本需做兼容处理。">1.4.0</a></td>
</tr>
<tr>
<td>abort</td>
<td></td>
<td>中断下载任务</td>
<td><a href="../framework/compatibility.html" title="基础库 1.4.0 开始支持，低版本需做兼容处理。">1.4.0</a></td>
</tr>
</tbody>
</table>
<p><strong>onProgressUpdate 返回参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>progress</td>
<td>Number</td>
<td>下载进度百分比</td>
</tr>
<tr>
<td>totalBytesWritten</td>
<td>Number</td>
<td>已经下载的数据长度，单位 Bytes</td>
</tr>
<tr>
<td>totalBytesExpectedToWrite</td>
<td>Number</td>
<td>预期需要下载的数据总长度，单位 Bytes</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> downloadTask = wx.downloadFile({
    url: <span class="hljs-string">'http://example.com/audio/123'</span>, <span class="hljs-comment">//仅为示例，并非真实的资源</span>
    success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) </span>{
        wx.playVoice({
            filePath: res.tempFilePath
        })
    }
})

downloadTask.onProgressUpdate((res) => {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'下载进度'</span>, res.progress)
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'已经下载的数据长度'</span>, res.totalBytesWritten)
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'预期需要下载的数据总长度'</span>, res.totalBytesExpectedToWrite)
})

downloadTask.abort() <span class="hljs-comment">// 取消下载任务</span>
</code></pre>
<h4 id="bug--tip">Bug & Tip</h4>
<ol>
<li><code>tip</code>: 6.5.3 以及之前版本的 iOS 微信客户端 <code>header</code> 设置无效</li>
</ol>

                                
                                </section>
                            
    </div>
    
</div>

                        
</body>
</html>
