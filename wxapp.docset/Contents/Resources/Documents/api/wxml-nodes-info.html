<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>WXML节点信息</title>
  <link rel="stylesheet" href="../style.css" />
  <link rel="stylesheet" href="../website.css" />
  <style type="text/css">
    body {
      padding: 1em;
    }
  </style>
</head>
<body>
  
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="wxml节点信息api">WXML节点信息API</h1>
<h2 id="wxcreateselectorquery">wx.createSelectorQuery()</h2>
<blockquote>
<p>基础库 1.4.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>返回一个SelectorQuery对象实例。可以在这个实例上使用<code>select</code>等方法选择节点，并使用<code>boundingClientRect</code>等方法选择需要查询的信息。</p>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">Page({
  queryMultipleNodes: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> query = wx.createSelectorQuery()
    query.select(<span class="hljs-string">'#the-id'</span>).boundingClientRect()
    query.selectViewport().scrollOffset()
    query.exec(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>)</span>{
      res[<span class="hljs-number">0</span>].top       <span class="hljs-comment">// #the-id节点的上边界坐标</span>
      res[<span class="hljs-number">1</span>].scrollTop <span class="hljs-comment">// 显示区域的竖直滚动位置</span>
    })
  }
})
</code></pre>
<h3 id="selectorquery">selectorQuery</h3>
<p><strong>selectorQuery 对象的方法列表：</strong></p>
<table>
<thead>
<tr>
<th>方法</th>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>in</td>
<td>object Component</td>
<td>参考下面详细介绍</td>
</tr>
<tr>
<td>select</td>
<td>selector</td>
<td>参考下面详细介绍</td>
</tr>
<tr>
<td>selectAll</td>
<td>selector</td>
<td>参考下面详细介绍</td>
</tr>
<tr>
<td>selectViewport</td>
<td></td>
<td>参考下面详细介绍</td>
</tr>
<tr>
<td>exec</td>
<td>[callback]</td>
<td>参考下面详细介绍</td>
</tr>
</tbody>
</table>
<h3 id="selectorqueryincomponent">selectorQuery.in(component)</h3>
<blockquote>
<p>基础库 1.6.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>将选择器的选取范围更改为自定义组件<code>component</code>内。（初始时，选择器仅选取页面范围的节点，不会选取任何自定义组件中的节点。）</p>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">Component({
  queryMultipleNodes: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> query = wx.createSelectorQuery().in(<span class="hljs-keyword">this</span>)
    query.select(<span class="hljs-string">'#the-id'</span>).boundingClientRect(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>)</span>{
      res.top <span class="hljs-comment">// 这个组件内 #the-id 节点的上边界坐标</span>
    }).exec()
  }
})
</code></pre>
<h3 id="selectorqueryselectselector">selectorQuery.select(selector)</h3>
<p>在当前页面下选择第一个匹配选择器<code>selector</code>的节点，返回一个<code>NodesRef</code>对象实例，可以用于获取节点信息。</p>
<p><code>selector</code>类似于CSS的选择器，但仅支持下列语法。</p>
<ul>
<li>ID选择器：<code>#the-id</code></li>
<li>class选择器（可以连续指定多个）：<code>.a-class.another-class</code></li>
<li>子元素选择器：<code>.the-parent > .the-child</code></li>
<li>后代选择器：<code>.the-ancestor .the-descendant</code></li>
<li>跨自定义组件的后代选择器：<code>.the-ancestor >>> .the-descendant</code></li>
<li>多选择器的并集：<code>#a-node, .some-other-nodes</code></li>
</ul>
<h3 id="selectorqueryselectallselector">selectorQuery.selectAll(selector)</h3>
<p>在当前页面下选择匹配选择器<code>selector</code>的节点，返回一个<code>NodesRef</code>对象实例。
与<code>selectorQuery.selectNode(selector)</code>不同的是，它选择所有匹配选择器的节点。</p>
<h3 id="selectorqueryselectviewport">selectorQuery.selectViewport()</h3>
<p>选择显示区域，可用于获取显示区域的尺寸、滚动位置等信息，返回一个<code>NodesRef</code>对象实例。</p>
<h3 id="nodesrefboundingclientrectcallback">nodesRef.boundingClientRect([callback])</h3>
<p>添加节点的布局位置的查询请求，相对于显示区域，以像素为单位。其功能类似于DOM的getBoundingClientRect。返回值是nodesRef对应的selectorQuery。</p>
<p>返回的节点信息中，每个节点的位置用<code>left</code>、<code>right</code>、<code>top</code>、<code>bottom</code>、<code>width</code>、<code>height</code>字段描述。如果提供了callback回调函数，在执行selectQuery的exec方法后，节点信息会在callback中返回。</p>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">Page({
  getRect: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    wx.createSelectorQuery().select(<span class="hljs-string">'#the-id'</span>).boundingClientRect(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">rect</span>)</span>{
      rect.id      <span class="hljs-comment">// 节点的ID</span>
      rect.dataset <span class="hljs-comment">// 节点的dataset</span>
      rect.left    <span class="hljs-comment">// 节点的左边界坐标</span>
      rect.right   <span class="hljs-comment">// 节点的右边界坐标</span>
      rect.top     <span class="hljs-comment">// 节点的上边界坐标</span>
      rect.bottom  <span class="hljs-comment">// 节点的下边界坐标</span>
      rect.width   <span class="hljs-comment">// 节点的宽度</span>
      rect.height  <span class="hljs-comment">// 节点的高度</span>
    }).exec()
  },
  getAllRects: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    wx.createSelectorQuery().selectAll(<span class="hljs-string">'.a-class'</span>).boundingClientRect(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">rects</span>)</span>{
      rects.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">rect</span>)</span>{
        rect.id      <span class="hljs-comment">// 节点的ID</span>
        rect.dataset <span class="hljs-comment">// 节点的dataset</span>
        rect.left    <span class="hljs-comment">// 节点的左边界坐标</span>
        rect.right   <span class="hljs-comment">// 节点的右边界坐标</span>
        rect.top     <span class="hljs-comment">// 节点的上边界坐标</span>
        rect.bottom  <span class="hljs-comment">// 节点的下边界坐标</span>
        rect.width   <span class="hljs-comment">// 节点的宽度</span>
        rect.height  <span class="hljs-comment">// 节点的高度</span>
      })
    }).exec()
  }
})
</code></pre>
<h3 id="nodesrefscrolloffsetcallback">nodesRef.scrollOffset([callback])</h3>
<p>添加节点的滚动位置查询请求，以像素为单位。节点必须是<code>scroll-view</code>或者viewport。返回值是nodesRef对应的selectorQuery。</p>
<p>返回的节点信息中，每个节点的滚动位置用<code>scrollLeft</code>、<code>scrollTop</code>字段描述。如果提供了callback回调函数，在执行selectQuery的exec方法后，节点信息会在callback中返回。</p>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">Page({
  getScrollOffset: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    wx.createSelectorQuery().selectViewport().scrollOffset(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>)</span>{
      res.id      <span class="hljs-comment">// 节点的ID</span>
      res.dataset <span class="hljs-comment">// 节点的dataset</span>
      res.scrollLeft <span class="hljs-comment">// 节点的水平滚动位置</span>
      res.scrollTop  <span class="hljs-comment">// 节点的竖直滚动位置</span>
    }).exec()
  }
})
</code></pre>
<h3 id="nodesreffieldsfields-callback">nodesRef.fields(fields, [callback])</h3>
<p>获取节点的相关信息，需要获取的字段在<code>fields</code>中指定。返回值是nodesRef对应的selectorQuery。可指定获取的字段包括：</p>
<table>
<thead>
<tr>
<th>字段名</th>
<th>默认值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>否</td>
<td>是否返回节点<code>id</code></td>
</tr>
<tr>
<td>dataset</td>
<td>否</td>
<td>是否返回节点<code>dataset</code></td>
</tr>
<tr>
<td>rect</td>
<td>否</td>
<td>是否返回节点布局位置（<code>left</code> <code>right</code> <code>top</code> <code>bottom</code>）</td>
</tr>
<tr>
<td>size</td>
<td>否</td>
<td>是否返回节点尺寸（<code>width</code> <code>height</code>）</td>
</tr>
<tr>
<td>scrollOffset</td>
<td>否</td>
<td>是否返回节点的 <code>scrollLeft</code> <code>scrollTop</code> ，节点必须是<code>scroll-view</code>或者viewport</td>
</tr>
<tr>
<td>properties</td>
<td><code>[]</code></td>
<td>指定属性名列表，返回节点对应属性名的当前属性值（只能获得组件文档中标注的常规属性值， <code>id</code> <code>class</code> <code>style</code> 和事件绑定的属性值不可获取）</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">Page({
  getFields: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    wx.createSelectorQuery().select(<span class="hljs-string">'#the-id'</span>).fields({
      dataset: <span class="hljs-literal">true</span>,
      size: <span class="hljs-literal">true</span>,
      scrollOffset: <span class="hljs-literal">true</span>,
      properties: [<span class="hljs-string">'scrollX'</span>, <span class="hljs-string">'scrollY'</span>]
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>)</span>{
      res.dataset    <span class="hljs-comment">// 节点的dataset</span>
      res.width      <span class="hljs-comment">// 节点的宽度</span>
      res.height     <span class="hljs-comment">// 节点的高度</span>
      res.scrollLeft <span class="hljs-comment">// 节点的水平滚动位置</span>
      res.scrollTop  <span class="hljs-comment">// 节点的竖直滚动位置</span>
      res.scrollX    <span class="hljs-comment">// 节点 scroll-x 属性的当前值</span>
      res.scrollY    <span class="hljs-comment">// 节点 scroll-x 属性的当前值</span>
    }).exec()
  }
})
</code></pre>
<h3 id="selectorqueryexeccallback">selectorQuery.exec([callback])</h3>
<p>执行所有的请求，请求结果按请求次序构成数组，在callback的第一个参数中返回。</p>

                                
                                </section>
                            
    </div>
    
</div>

                        
</body>
</html>
