<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>UpdateManager</title>
  <link rel="stylesheet" href="../../../../../../../style.css" />
  <link rel="stylesheet" href="../../../../../../../website.css" />
  <style type="text/css">
    body {
      padding: 1em;
    }
  </style>
</head>
<body>
   <div id="docContent"><div class="content custom"><h1 id="UpdateManager"><a href="#UpdateManager" aria-hidden="true" class="header-anchor">#</a> UpdateManager</h1> <p>UpdateManager 对象，用来管理更新，可通过 <a href="wx.getUpdateManager.html">wx.getUpdateManager</a> 接口获取实例。</p> <h2 id="方法"><a href="#方法" aria-hidden="true" class="header-anchor">#</a> 方法</h2> <h3 id="UpdateManager-applyUpdate"><a href="#UpdateManager-applyUpdate" aria-hidden="true" class="header-anchor">#</a> <a href="UpdateManager.applyUpdate.html">UpdateManager.applyUpdate()</a></h3> <p>强制小程序重启并使用新版本。在小程序新版本下载完成后（即收到 <code>onUpdateReady</code> 回调）调用。</p> <h3 id="UpdateManager-onCheckForUpdate-function-callback"><a href="#UpdateManager-onCheckForUpdate-function-callback" aria-hidden="true" class="header-anchor">#</a> <a href="./UpdateManager.onCheckForUpdate.html">UpdateManager.onCheckForUpdate(function callback)</a></h3> <p>监听向微信后台请求检查更新结果事件。微信在小程序冷启动时自动检查更新，不需由开发者主动触发。</p> <h3 id="UpdateManager-onUpdateReady-function-callback"><a href="#UpdateManager-onUpdateReady-function-callback" aria-hidden="true" class="header-anchor">#</a> <a href="./UpdateManager.onUpdateReady.html">UpdateManager.onUpdateReady(function callback)</a></h3> <p>监听小程序有版本更新事件。客户端主动触发下载（无需开发者触发），下载成功后回调</p> <h3 id="UpdateManager-onUpdateFailed-function-callback"><a href="#UpdateManager-onUpdateFailed-function-callback" aria-hidden="true" class="header-anchor">#</a> <a href="./UpdateManager.onUpdateFailed.html">UpdateManager.onUpdateFailed(function callback)</a></h3> <p>监听小程序更新失败事件。小程序有新版本，客户端主动触发下载（无需开发者触发），下载失败（可能是网络原因等）后回调</p> <h2 id="示例代码"><a href="#示例代码" aria-hidden="true" class="header-anchor">#</a> 示例代码</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> updateManager <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getUpdateManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

updateManager<span class="token punctuation">.</span><span class="token function">onCheckForUpdate</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 请求完新版本信息的回调</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>hasUpdate<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

updateManager<span class="token punctuation">.</span><span class="token function">onUpdateReady</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  wx<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">'更新提示'</span><span class="token punctuation">,</span>
    content<span class="token punctuation">:</span> <span class="token string">'新版本已经准备好，是否重启应用？'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>confirm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 新的版本已经下载好，调用 applyUpdate 应用新版本并重启</span>
        updateManager<span class="token punctuation">.</span><span class="token function">applyUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

updateManager<span class="token punctuation">.</span><span class="token function">onUpdateFailed</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 新版本下载失败</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="Tips"><a href="#Tips" aria-hidden="true" class="header-anchor">#</a> Tips</h2> <ol><li>微信开发者工具上可以通过「编译模式」下的「下次编译模拟更新」开关来调试</li> <li>小程序开发版/体验版没有「版本」概念，所以无法在开发版/体验版上测试更版本更新情况</li></ol></div></div> <!---->    
</body>
</html>
