<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>蓝牙</title>
  <link rel="stylesheet" href="../style.css" />
  <link rel="stylesheet" href="../website.css" />
  <style type="text/css">
    body {
      padding: 1em;
    }
  </style>
</head>
<body>
  
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="蓝牙适配器接口">蓝牙适配器接口</h2>
<blockquote>
<p> 基础库版本 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
<p> iOS 微信客户端 6.5.6 版本开始支持，Android 6.5.7 版本开始支持</p>
<p>目前不支持在开发者工具上进行调试，需要使用真机才能正常调用小程序蓝牙接口 </p>
</blockquote>
<h3 id="wxopenbluetoothadapterobject">wx.openBluetoothAdapter(OBJECT)</h3>
<blockquote>
<p>基础库 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>初始化小程序蓝牙模块，生效周期为调用<code>wx.openBluetoothAdapter</code>至调用<code>wx.closeBluetoothAdapter</code>或小程序被销毁为止。
在小程序蓝牙适配器模块生效期间，开发者可以正常调用下面的小程序API，并会收到蓝牙模块相关的on回调。</p>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>success</td>
<td>Function</td>
<td>是</td>
<td>成功则返回成功初始化信息</td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">wx.openBluetoothAdapter({
  success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
    <span class="hljs-built_in">console</span>.log(res)
  }
})
</code></pre>
<h4 id="bug--tip">Bug & Tip</h4>
<ol>
<li><code>tip</code>: 基础库版本 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></li>
<li><code>tip</code>: 在没有调用<code>wx.openBluetoothAdapter</code>的情况下调用小程序其它蓝牙模块相关API，API会返回错误，错误码为<code>10000</code></li>
<li><code>bug</code>: 在用户蓝牙开关未开启或者手机不支持蓝牙功能的情况下，调用<code>wx.openBluetoothAdapter</code>会返回错误，错误码为<code>10001</code>，表示手机蓝牙功能不可用；此时小程序蓝牙模块已经初始化完成，可通过<code>wx.onBluetoothAdapterStateChange</code>监听手机蓝牙状态的改变，也可以调用蓝牙模块的所有API。</li>
</ol>
<h3 id="wxclosebluetoothadapterobject">wx.closeBluetoothAdapter(OBJECT)</h3>
<blockquote>
<p>基础库 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>关闭蓝牙模块，使其进入未初始化状态。调用该方法将断开所有已建立的链接并释放系统资源。建议在使用小程序蓝牙流程后调用，与<code>wx.openBluetoothAdapter</code>成对调用。</p>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>success</td>
<td>Function</td>
<td>是</td>
<td>成功则返回成功关闭模块信息</td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">wx.closeBluetoothAdapter({
  success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
    <span class="hljs-built_in">console</span>.log(res)
  }
})
</code></pre>
<h3 id="wxgetbluetoothadapterstateobject">wx.getBluetoothAdapterState(OBJECT)</h3>
<blockquote>
<p>基础库 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>获取本机蓝牙适配器状态</p>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>success</td>
<td>Function</td>
<td>是</td>
<td>成功则返回本机蓝牙适配器状态</td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>success返回参数：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>discovering</td>
<td>Boolean</td>
<td>是否正在搜索设备</td>
</tr>
<tr>
<td>available</td>
<td>Boolean</td>
<td>蓝牙适配器是否可用</td>
</tr>
<tr>
<td>errMsg</td>
<td>String</td>
<td>成功：ok，错误：详细信息</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">wx.getBluetoothAdapterState({
  success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
    <span class="hljs-built_in">console</span>.log(res)
  }
})
</code></pre>
<h3 id="wxonbluetoothadapterstatechangecallback">wx.onBluetoothAdapterStateChange(CALLBACK)</h3>
<blockquote>
<p>基础库 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>监听蓝牙适配器状态变化事件</p>
<p><strong>CALLBACK参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>available</td>
<td>Boolean</td>
<td>蓝牙适配器是否可用</td>
</tr>
<tr>
<td>discovering</td>
<td>Boolean</td>
<td>蓝牙适配器是否处于搜索状态</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">wx.onBluetoothAdapterStateChange(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`adapterState changed, now is`</span>, res)
})
</code></pre>
<h3 id="wxstartbluetoothdevicesdiscoveryobject">wx.startBluetoothDevicesDiscovery(OBJECT)</h3>
<blockquote>
<p>基础库 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>开始搜寻附近的蓝牙外围设备。注意，该操作比较耗费系统资源，请在搜索并连接到设备后调用 stop 方法停止搜索。</p>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>services</td>
<td>Array</td>
<td>否</td>
<td>蓝牙设备主 service 的 uuid 列表</td>
</tr>
<tr>
<td>allowDuplicatesKey</td>
<td>Boolean</td>
<td>否</td>
<td>是否允许重复上报同一设备， 如果允许重复上报，则onDeviceFound 方法会多次上报同一设备，但是 RSSI 值会有不同</td>
</tr>
<tr>
<td>interval</td>
<td>Number</td>
<td>否</td>
<td>上报设备的间隔，默认为0，意思是找到新设备立即上报，否则根据传入的间隔上报</td>
</tr>
<tr>
<td>success</td>
<td>Function</td>
<td>是</td>
<td>成功则返回本机蓝牙适配器状态</td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>services</strong>参数说明：某些蓝牙设备会广播自己的主 service 的 uuid。如果这里传入该数组，那么根据该 uuid 列表，只搜索发出广播包有这个主服务的蓝牙设备，建议主要通过该参数过滤掉周边不需要处理的其他蓝牙设备。</p>
<p><strong>success返回参数：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>errMsg</td>
<td>String</td>
<td>成功：ok，错误：详细信息</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript"><span class="hljs-comment">// 以微信硬件平台的蓝牙智能灯为例，主服务的 UUID 是 FEE7。传入这个参数，只搜索主服务 UUID 为 FEE7 的设备</span>
wx.startBluetoothDevicesDiscovery({
  services: [<span class="hljs-string">'FEE7'</span>],
  success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
    <span class="hljs-built_in">console</span>.log(res)
  }
})
</code></pre>
<h3 id="wxstopbluetoothdevicesdiscoveryobject">wx.stopBluetoothDevicesDiscovery(OBJECT)</h3>
<blockquote>
<p>基础库 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>停止搜寻附近的蓝牙外围设备。若已经找到需要的蓝牙设备并不需要继续搜索时，建议调用该接口停止蓝牙搜索。</p>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>success</td>
<td>Function</td>
<td>是</td>
<td>成功则返回本机蓝牙适配器状态</td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>success返回参数：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>errMsg</td>
<td>String</td>
<td>成功：ok，错误：详细信息</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">wx.stopBluetoothDevicesDiscovery({
  success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
    <span class="hljs-built_in">console</span>.log(res)
  }
})
</code></pre>
<h3 id="wxgetbluetoothdevicesobject">wx.getBluetoothDevices(OBJECT)</h3>
<blockquote>
<p>基础库 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>获取在小程序蓝牙模块生效期间所有已发现的蓝牙设备，包括已经和本机处于连接状态的设备。</p>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>success</td>
<td>Function</td>
<td>是</td>
<td>成功则返回本机蓝牙适配器状态</td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>success返回参数：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>devices</td>
<td>Array</td>
<td>uuid 对应的的已连接设备列表</td>
</tr>
<tr>
<td>errMsg</td>
<td>String</td>
<td>成功：ok，错误：详细信息</td>
</tr>
</tbody>
</table>
<h4 id="device-对象">device 对象</h4>
<p>蓝牙设备信息</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>蓝牙设备名称，某些设备可能没有</td>
</tr>
<tr>
<td>deviceId</td>
<td>String</td>
<td>用于区分设备的 id</td>
</tr>
<tr>
<td>RSSI</td>
<td>Number</td>
<td>当前蓝牙设备的信号强度</td>
</tr>
<tr>
<td>advertisData</td>
<td>ArrayBuffer</td>
<td>当前蓝牙设备的广播数据段中的ManufacturerData数据段 <strong>（注意：vConsole 无法打印出 ArrayBuffer 类型数据）</strong></td>
</tr>
<tr>
<td>advertisServiceUUIDs</td>
<td>Array</td>
<td>当前蓝牙设备的广播数据段中的ServiceUUIDs数据段</td>
</tr>
<tr>
<td>localName</td>
<td>String</td>
<td>当前蓝牙设备的广播数据段中的LocalName数据段</td>
</tr>
<tr>
<td>serviceData</td>
<td>ArrayBuffer</td>
<td>当前蓝牙设备的广播数据段中的ServiceData数据段</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript"><span class="hljs-comment">// ArrayBuffer转16进度字符串示例</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ab2hex</span>(<span class="hljs-params">buffer</span>) </span>{
  <span class="hljs-keyword">var</span> hexArr = <span class="hljs-built_in">Array</span>.prototype.map.call(
    <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(buffer),
    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">bit</span>) </span>{
      <span class="hljs-keyword">return</span> (<span class="hljs-string">'00'</span> + bit.toString(<span class="hljs-number">16</span>)).slice(<span class="hljs-number">-2</span>)
    }
  )
  <span class="hljs-keyword">return</span> hexArr.join(<span class="hljs-string">''</span>);
}
wx.getBluetoothDevices({
  success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
    <span class="hljs-built_in">console</span>.log(res)
    <span class="hljs-keyword">if</span> (res.devices[<span class="hljs-number">0</span>]) {
      <span class="hljs-built_in">console</span>.log(ab2hex(res.devices[<span class="hljs-number">0</span>].advertisData))
    }
  }
})
</code></pre>
<h4 id="bug--tip">Bug & Tip</h4>
<ol>
<li><code>tip</code>: Mac系统可能无法获取<code>advertisData</code>及<code>RSSI</code>，请使用真机调试</li>
<li><code>tip</code>: 开发者工具和 Android 上获取到的<code>deviceId</code>为设备 MAC 地址，iOS 上则为设备 uuid。因此<code>deviceId</code>不能硬编码到代码中</li>
<li><code>tip</code>: 注意该接口获取到的设备列表为<strong>小程序蓝牙模块生效期间所有搜索到的蓝牙设备</strong>，若在蓝牙模块使用流程结束后未及时调用 wx.closeBluetoothAdapter 释放资源，会存在调用该接口会返回之前的蓝牙使用流程中搜索到的蓝牙设备，可能设备已经不在用户身边，无法连接。</li>
<li><code>tips</code>: 蓝牙设备在被搜索到时，系统返回的 name 字段一般为广播包中的LocalName字段中的设备名称，而如果与蓝牙设备建立连接，系统返回的 name 字段会改为从蓝牙设备上获取到的GattName。若需要动态改变设备名称并展示，建议使用localName字段。</li>
</ol>
<h3 id="wxonbluetoothdevicefoundcallback">wx.onBluetoothDeviceFound(CALLBACK)</h3>
<blockquote>
<p>基础库 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>监听寻找到新设备的事件</p>
<p><strong>CALLBACK参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>devices</td>
<td>Array</td>
<td>新搜索到的设备列表</td>
</tr>
</tbody>
</table>
<h4 id="device-对象">device 对象</h4>
<p>蓝牙设备信息</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>蓝牙设备名称，某些设备可能没有</td>
</tr>
<tr>
<td>deviceId</td>
<td>String</td>
<td>用于区分设备的 id</td>
</tr>
<tr>
<td>RSSI</td>
<td>Number</td>
<td>当前蓝牙设备的信号强度</td>
</tr>
<tr>
<td>advertisData</td>
<td>ArrayBuffer</td>
<td>当前蓝牙设备的广播数据段中的ManufacturerData数据段 <strong>（注意：vConsole 无法打印出 ArrayBuffer 类型数据）</strong></td>
</tr>
<tr>
<td>advertisServiceUUIDs</td>
<td>Array</td>
<td>当前蓝牙设备的广播数据段中的ServiceUUIDs数据段</td>
</tr>
<tr>
<td>localName</td>
<td>String</td>
<td>当前蓝牙设备的广播数据段中的LocalName数据段</td>
</tr>
<tr>
<td>serviceData</td>
<td>ArrayBuffer</td>
<td>当前蓝牙设备的广播数据段中的ServiceData数据段</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript"><span class="hljs-comment">// ArrayBuffer转16进度字符串示例</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ab2hex</span>(<span class="hljs-params">buffer</span>) </span>{
  <span class="hljs-keyword">var</span> hexArr = <span class="hljs-built_in">Array</span>.prototype.map.call(
    <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(buffer),
    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">bit</span>) </span>{
      <span class="hljs-keyword">return</span> (<span class="hljs-string">'00'</span> + bit.toString(<span class="hljs-number">16</span>)).slice(<span class="hljs-number">-2</span>)
    }
  )
  <span class="hljs-keyword">return</span> hexArr.join(<span class="hljs-string">''</span>);
}
wx.onBluetoothDeviceFound(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">devices</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'new device list has founded'</span>)
  <span class="hljs-built_in">console</span>.dir(devices)
  <span class="hljs-built_in">console</span>.log(ab2hex(devices[<span class="hljs-number">0</span>].advertisData))
})
</code></pre>
<h4 id="bug--tip">Bug & Tip</h4>
<ol>
<li><code>tip</code>: Mac系统可能无法获取<code>advertisData</code>及<code>RSSI</code>，请使用真机调试</li>
<li><code>tip</code>: 开发者工具和 Android 上获取到的<code>deviceId</code>为设备 MAC 地址，iOS 上则为设备 uuid。因此<code>deviceId</code>不能硬编码到代码中</li>
<li><code>tip</code>: 若在onBluetoothDeviceFound回调了某个设备，则此设备会添加到 wx.getBluetoothDevices 接口获取到的数组中</li>
</ol>
<h3 id="wxgetconnectedbluetoothdevicesobject">wx.getConnectedBluetoothDevices(OBJECT)</h3>
<blockquote>
<p>基础库 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>根据 uuid 获取处于已连接状态的设备</p>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>services</td>
<td>Array</td>
<td>是</td>
<td>蓝牙设备主 service 的 uuid 列表</td>
</tr>
<tr>
<td>success</td>
<td>Function</td>
<td>是</td>
<td>成功则返回本机蓝牙适配器状态</td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>success返回参数：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>devices</td>
<td>Array</td>
<td>搜索到的设备列表</td>
</tr>
<tr>
<td>errMsg</td>
<td>String</td>
<td>成功：ok，错误：详细信息</td>
</tr>
</tbody>
</table>
<h4 id="device对象">device对象</h4>
<p>蓝牙设备信息</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>String</td>
<td>蓝牙设备名称，某些设备可能没有</td>
</tr>
<tr>
<td>deviceId</td>
<td>String</td>
<td>用于区分设备的 id</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">wx.getConnectedBluetoothDevices({
  success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
    <span class="hljs-built_in">console</span>.log(res)
  }
})
</code></pre>
<h4 id="bug--tip">Bug & Tip</h4>
<ol>
<li><code>tip</code>: 开发者工具和 Android 上获取到的<code>deviceId</code>为设备 MAC 地址，iOS 上则为设备 uuid。因此<code>deviceId</code>不能硬编码到代码中</li>
</ol>
<h2 id="低功耗蓝牙接口">低功耗蓝牙接口</h2>
<h3 id="wxcreatebleconnectionobject">wx.createBLEConnection(OBJECT)</h3>
<blockquote>
<p>基础库 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>连接低功耗蓝牙设备。</p>
<blockquote>
<p>若小程序在之前已有搜索过某个蓝牙设备，并成功建立链接，可直接传入之前搜索获取的deviceId直接尝试连接该设备，无需进行搜索操作。</p>
</blockquote>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>deviceId</td>
<td>String</td>
<td>是</td>
<td>蓝牙设备 id，参考 getDevices 接口</td>
</tr>
<tr>
<td>success</td>
<td>Function</td>
<td>是</td>
<td>成功则返回本机蓝牙适配器状态</td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>success返回参数：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>errMsg</td>
<td>String</td>
<td>成功：ok，错误：详细信息</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">wx.createBLEConnection({
  <span class="hljs-comment">// 这里的 deviceId 需要已经通过 createBLEConnection 与对应设备建立链接 </span>
  deviceId: deviceId,
  success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
    <span class="hljs-built_in">console</span>.log(res)
  }
})
</code></pre>
<h4 id="bug--tip">Bug & Tip</h4>
<ol>
<li><code>tip</code>: 安卓手机上如果多次调用create创建连接，有可能导致系统持有同一设备多个连接的实例，导致调用close的时候并不能真正的断开与设备的连接。因此请保证尽量成对的调用create和close接口</li>
<li><code>tip</code>: 蓝牙链接随时可能断开，建议监听 wx.onBLEConnectionStateChange 回调事件，当蓝牙设备断开时按需执行重连操作 </li>
<li><code>tip</code>: 若对未连接的设备或已断开连接的设备调用数据读写操作的接口，会返回10006错误，详见错误码，建议进行重连操作</li>
</ol>
<h3 id="wxclosebleconnectionobject">wx.closeBLEConnection(OBJECT)</h3>
<blockquote>
<p>基础库 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>断开与低功耗蓝牙设备的连接</p>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>deviceId</td>
<td>String</td>
<td>是</td>
<td>蓝牙设备 id，参考 getDevices 接口</td>
</tr>
<tr>
<td>success</td>
<td>Function</td>
<td>是</td>
<td>成功则返回本机蓝牙适配器状态</td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>success返回参数：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>errMsg</td>
<td>String</td>
<td>成功：ok，错误：详细信息</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">wx.closeBLEConnection({
  deviceId:deviceId
  success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
    <span class="hljs-built_in">console</span>.log(res)
  }
})
</code></pre>
<h3 id="wxonbleconnectionstatechangecallback">wx.onBLEConnectionStateChange(CALLBACK)</h3>
<blockquote>
<p>基础库 1.1.1 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>监听低功耗蓝牙连接状态的改变事件，包括开发者主动连接或断开连接，设备丢失，连接异常断开等等</p>
<p><strong>CALLBACK参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>deviceId</td>
<td>String</td>
<td>蓝牙设备 id，参考 device 对象</td>
</tr>
<tr>
<td>connected</td>
<td>Boolean</td>
<td>连接目前的状态</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">wx.onBLEConnectionStateChange(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) </span>{
  <span class="hljs-comment">// 该方法回调中可以用于处理连接意外断开等异常情况</span>
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`device <span class="hljs-subst">${res.deviceId}</span> state has changed, connected: <span class="hljs-subst">${res.connected}</span>`</span>)
})
</code></pre>
<h3 id="wxgetbledeviceservicesobject">wx.getBLEDeviceServices(OBJECT)</h3>
<blockquote>
<p>基础库 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>获取蓝牙设备所有 service（服务）</p>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>deviceId</td>
<td>String</td>
<td>是</td>
<td>蓝牙设备 id，参考 getDevices 接口</td>
</tr>
<tr>
<td>success</td>
<td>Function</td>
<td>是</td>
<td>成功则返回本机蓝牙适配器状态</td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>success返回参数：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>services</td>
<td>Array</td>
<td>设备服务列表</td>
</tr>
<tr>
<td>errMsg</td>
<td>String</td>
<td>成功：ok，错误：详细信息</td>
</tr>
</tbody>
</table>
<h4 id="service对象">service对象</h4>
<p>蓝牙设备service(服务)信息</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>uuid</td>
<td>String</td>
<td>蓝牙设备服务的 uuid</td>
</tr>
<tr>
<td>isPrimary</td>
<td>Boolean</td>
<td>该服务是否为主服务</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">wx.getBLEDeviceServices({
  <span class="hljs-comment">// 这里的 deviceId 需要已经通过 createBLEConnection 与对应设备建立链接 </span>
  deviceId: deviceId,
  success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'device services:'</span>, res.services)
  }
})
</code></pre>
<h4 id="bug--tip">Bug & Tip</h4>
<ol>
<li><code>tip</code>:iOS平台上后续对特征值的read、write、notify，由于系统需要获取特征值实例，传入的 serviceId 与 characteristicId 必须由 getBLEDeviceServices 与 getBLEDeviceCharacteristics 中获取到后才能使用。建议双平台统一在建立链接后先执行 getBLEDeviceServices 与 getBLEDeviceCharacteristics 后再进行与蓝牙设备的数据交互</li>
</ol>
<h3 id="wxgetbledevicecharacteristicsobject">wx.getBLEDeviceCharacteristics(OBJECT)</h3>
<blockquote>
<p>基础库 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p> 获取蓝牙设备某个服务中的所有 characteristic（特征值） </p>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>deviceId</td>
<td>String</td>
<td>是</td>
<td>蓝牙设备 id，参考 device 对象</td>
</tr>
<tr>
<td>serviceId</td>
<td>String</td>
<td>是</td>
<td>蓝牙服务 uuid</td>
</tr>
<tr>
<td>success</td>
<td>Function</td>
<td>是</td>
<td>成功则返回本机蓝牙适配器状态</td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>success返回参数：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>characteristics</td>
<td>Array</td>
<td>设备特征值列表</td>
</tr>
<tr>
<td>errMsg</td>
<td>String</td>
<td>成功：ok，错误：详细信息</td>
</tr>
</tbody>
</table>
<h4 id="characteristic对象">characteristic对象</h4>
<p>蓝牙设备characteristic(特征值)信息</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>uuid</td>
<td>String</td>
<td>蓝牙设备特征值的 uuid</td>
</tr>
<tr>
<td>properties</td>
<td>Object</td>
<td>该特征值支持的操作类型</td>
</tr>
</tbody>
</table>
<h5 id="properties对象">properties对象</h5>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>read</td>
<td>Boolean</td>
<td>该特征值是否支持 read 操作</td>
</tr>
<tr>
<td>write</td>
<td>Boolean</td>
<td>该特征值是否支持 write 操作</td>
</tr>
<tr>
<td>notify</td>
<td>Boolean</td>
<td>该特征值是否支持 notify 操作</td>
</tr>
<tr>
<td>indicate</td>
<td>Boolean</td>
<td>该特征值是否支持 indicate 操作</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">wx.getBLEDeviceCharacteristics({
  <span class="hljs-comment">// 这里的 deviceId 需要已经通过 createBLEConnection 与对应设备建立链接</span>
  deviceId: deviceId,
  <span class="hljs-comment">// 这里的 serviceId 需要在上面的 getBLEDeviceServices 接口中获取</span>
  serviceId: serviceId,
  success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'device getBLEDeviceCharacteristics:'</span>, res.characteristics)
  }
})
</code></pre>
<h4 id="bug--tip">Bug & Tip</h4>
<ol>
<li><code>tip</code>:传入的serviceId需要在getBLEDeviceServices获取到</li>
<li><code>tip</code>:iOS平台上后续对特征值的read、write、notify，由于系统需要获取特征值实例，传入的 serviceId 与 characteristicId 必须由 getBLEDeviceServices 与 getBLEDeviceCharacteristics 中获取到后才能使用。建议双平台统一在建立链接后先执行 getBLEDeviceServices 与 getBLEDeviceCharacteristics 后再进行与蓝牙设备的数据交互  </li>
</ol>
<h3 id="wxreadblecharacteristicvalueobject">wx.readBLECharacteristicValue(OBJECT)</h3>
<blockquote>
<p>基础库 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>读取低功耗蓝牙设备的特征值的二进制数据值。注意：必须设备的特征值支持<code>read</code>才可以成功调用，具体参照 characteristic 的 properties 属性</p>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>deviceId</td>
<td>String</td>
<td>是</td>
<td>蓝牙设备 id，参考 device 对象</td>
</tr>
<tr>
<td>serviceId</td>
<td>String</td>
<td>是</td>
<td>蓝牙特征值对应服务的 uuid</td>
</tr>
<tr>
<td>characteristicId</td>
<td>String</td>
<td>是</td>
<td>蓝牙特征值的 uuid</td>
</tr>
<tr>
<td>success</td>
<td>Function</td>
<td>是</td>
<td>成功则返回本机蓝牙适配器状态</td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>success返回参数：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>errCode</td>
<td>Number</td>
<td>错误码</td>
</tr>
<tr>
<td>errMsg</td>
<td>String</td>
<td>成功：ok，错误：详细信息</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript"><span class="hljs-comment">// 必须在这里的回调才能获取</span>
wx.onBLECharacteristicValueChange(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">characteristic</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'characteristic value comed:'</span>, characteristic)
})

wx.readBLECharacteristicValue({
  <span class="hljs-comment">// 这里的 deviceId 需要已经通过 createBLEConnection 与对应设备建立链接  [**new**]</span>
  deviceId: deviceId,
  <span class="hljs-comment">// 这里的 serviceId 需要在上面的 getBLEDeviceServices 接口中获取</span>
  serviceId: serviceId,
  <span class="hljs-comment">// 这里的 characteristicId 需要在上面的 getBLEDeviceCharacteristics 接口中获取</span>
  characteristicId: characteristicId,
  success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'readBLECharacteristicValue:'</span>, res.errCode)
  }
})
</code></pre>
<h4 id="bug--tip">Bug & Tip</h4>
<ol>
<li><code>tip</code>: 并行调用多次读写接口存在读写失败的可能性。</li>
<li><code>tip</code>: <code>read</code>接口读取到的信息需要在<code>onBLECharacteristicValueChange</code>方法注册的回调中获取。</li>
</ol>
<h3 id="wxwriteblecharacteristicvalueobject">wx.writeBLECharacteristicValue(OBJECT)</h3>
<blockquote>
<p>基础库 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>向低功耗蓝牙设备特征值中写入二进制数据。注意：必须设备的特征值支持<code>write</code>才可以成功调用，具体参照 characteristic 的 properties 属性</p>
<p><em>tips: 并行调用多次读写接口存在读写失败的可能性</em></p>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>deviceId</td>
<td>String</td>
<td>是</td>
<td>蓝牙设备 id，参考 device 对象</td>
</tr>
<tr>
<td>serviceId</td>
<td>String</td>
<td>是</td>
<td>蓝牙特征值对应服务的 uuid</td>
</tr>
<tr>
<td>characteristicId</td>
<td>String</td>
<td>是</td>
<td>蓝牙特征值的 uuid</td>
</tr>
<tr>
<td>value</td>
<td>ArrayBuffer</td>
<td>是</td>
<td>蓝牙设备特征值对应的二进制值</td>
</tr>
<tr>
<td>success</td>
<td>Function</td>
<td>是</td>
<td>成功则返回本机蓝牙适配器状态</td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>success返回参数：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>errMsg</td>
<td>String</td>
<td>成功：ok，错误：详细信息</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript"><span class="hljs-comment">// 向蓝牙设备发送一个0x00的16进制数据</span>
<span class="hljs-keyword">let</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayBuffer</span>(<span class="hljs-number">1</span>)
<span class="hljs-keyword">let</span> dataView = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DataView</span>(buffer)
dataView.setUint8(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)

wx.writeBLECharacteristicValue({
  <span class="hljs-comment">// 这里的 deviceId 需要在上面的 getBluetoothDevices 或 onBluetoothDeviceFound 接口中获取</span>
  deviceId: deviceId,
  <span class="hljs-comment">// 这里的 serviceId 需要在上面的 getBLEDeviceServices 接口中获取</span>
  serviceId: serviceId,
  <span class="hljs-comment">// 这里的 characteristicId 需要在上面的 getBLEDeviceCharacteristics 接口中获取</span>
  characteristicId: characteristicId,
  <span class="hljs-comment">// 这里的value是ArrayBuffer类型</span>
  value: buffer,
  success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'writeBLECharacteristicValue success'</span>, res.errMsg)
  }
})
</code></pre>
<h4 id="bug--tip">Bug & Tip</h4>
<ol>
<li><code>tip</code>: 并行调用多次读写接口存在读写失败的可能性。</li>
<li><code>tip</code>: 小程序不会对写入数据包大小做限制，但系统与蓝牙设备会确定蓝牙4.0单次传输的数据大小，超过最大字节数后会发生写入错误，建议每次写入不超过20字节。</li>
<li><code>tip</code>: 安卓平台上，在调用notify成功后立即调用write接口，在部分机型上会发生 10008 系统错误</li>
<li><code>bug</code>: 若单次写入数据过长，iOS平台上存在系统不会有任何回调的情况(包括错误回调)。</li>
</ol>
<h3 id="wxnotifyblecharacteristicvaluechangeobject">wx.notifyBLECharacteristicValueChange(OBJECT)</h3>
<blockquote>
<p>基础库 1.1.1 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>启用低功耗蓝牙设备特征值变化时的 notify 功能，订阅特征值。注意：必须设备的特征值支持<code>notify</code>或者<code>indicate</code>才可以成功调用，具体参照 characteristic 的 properties 属性 </p>
<p>另外，必须先启用<code>notify</code>才能监听到设备 characteristicValueChange 事件</p>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>deviceId</td>
<td>String</td>
<td>是</td>
<td>蓝牙设备 id，参考 device 对象</td>
</tr>
<tr>
<td>serviceId</td>
<td>String</td>
<td>是</td>
<td>蓝牙特征值对应服务的 uuid</td>
</tr>
<tr>
<td>characteristicId</td>
<td>String</td>
<td>是</td>
<td>蓝牙特征值的 uuid</td>
</tr>
<tr>
<td>state</td>
<td>Boolean</td>
<td>是</td>
<td>true: 启用 notify; false: 停用 notify</td>
</tr>
<tr>
<td>success</td>
<td>Function</td>
<td>是</td>
<td>成功则返回本机蓝牙适配器状态</td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>success返回参数：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>errMsg</td>
<td>String</td>
<td>成功：ok，错误：详细信息</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">wx.notifyBLECharacteristicValueChange({
  state: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 启用 notify 功能</span>
  <span class="hljs-comment">// 这里的 deviceId 需要已经通过 createBLEConnection 与对应设备建立链接  </span>
  deviceId: deviceId,
  <span class="hljs-comment">// 这里的 serviceId 需要在上面的 getBLEDeviceServices 接口中获取</span>
  serviceId: serviceId,
  <span class="hljs-comment">// 这里的 characteristicId 需要在上面的 getBLEDeviceCharacteristics 接口中获取</span>
  characteristicId: characteristicId,
  success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'notifyBLECharacteristicValueChange success'</span>, res.errMsg)
  }
})
</code></pre>
<h4 id="bug--tip">Bug & Tip</h4>
<ol>
<li><code>tip</code>: 订阅操作成功后需要设备主动更新特征值的value，才会触发 wx.onBLECharacteristicValueChange 回调。 </li>
<li><code>tip</code>: 安卓平台上，在调用notify成功后立即调用write接口，在部分机型上会发生 10008 系统错误</li>
</ol>
<h3 id="wxonblecharacteristicvaluechangecallback">wx.onBLECharacteristicValueChange(CALLBACK)</h3>
<blockquote>
<p>基础库 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>监听低功耗蓝牙设备的特征值变化。必须先启用<code>notify</code>接口才能接收到设备推送的notification。</p>
<p><strong>CALLBACK参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>deviceId</td>
<td>String</td>
<td>蓝牙设备 id，参考 device 对象</td>
</tr>
<tr>
<td>serviceId</td>
<td>String</td>
<td>特征值所属服务 uuid</td>
</tr>
<tr>
<td>characteristicId</td>
<td>String</td>
<td>特征值 uuid</td>
</tr>
<tr>
<td>value</td>
<td>ArrayBuffer</td>
<td>特征值最新的值 <strong>（注意：vConsole 无法打印出 ArrayBuffer 类型数据）</strong></td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript"><span class="hljs-comment">// ArrayBuffer转16进度字符串示例</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ab2hex</span>(<span class="hljs-params">buffer</span>) </span>{
  <span class="hljs-keyword">var</span> hexArr = <span class="hljs-built_in">Array</span>.prototype.map.call(
    <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(buffer),
    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">bit</span>) </span>{
      <span class="hljs-keyword">return</span> (<span class="hljs-string">'00'</span> + bit.toString(<span class="hljs-number">16</span>)).slice(<span class="hljs-number">-2</span>)
    }
  )
  <span class="hljs-keyword">return</span> hexArr.join(<span class="hljs-string">''</span>);
}
wx.onBLECharacteristicValueChange(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`characteristic <span class="hljs-subst">${res.characteristicId}</span> has changed, now is <span class="hljs-subst">${res.value}</span>`</span>)
  <span class="hljs-built_in">console</span>.log(ab2hext(res.value))
})
</code></pre>
<h3 id="蓝牙错误码errcode列表">蓝牙错误码(errCode)列表</h3>
<table>
<thead>
<tr>
<th>错误码</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>ok</td>
<td>正常</td>
</tr>
<tr>
<td>10000</td>
<td>not init</td>
<td>未初始化蓝牙适配器</td>
</tr>
<tr>
<td>10001</td>
<td>not available</td>
<td>当前蓝牙适配器不可用</td>
</tr>
<tr>
<td>10002</td>
<td>no device</td>
<td>没有找到指定设备</td>
</tr>
<tr>
<td>10003</td>
<td>connection fail</td>
<td>连接失败</td>
</tr>
<tr>
<td>10004</td>
<td>no service</td>
<td>没有找到指定服务</td>
</tr>
<tr>
<td>10005</td>
<td>no characteristic</td>
<td>没有找到指定特征值</td>
</tr>
<tr>
<td>10006</td>
<td>no connection</td>
<td>当前连接已断开</td>
</tr>
<tr>
<td>10007</td>
<td>property not support</td>
<td>当前特征值不支持此操作</td>
</tr>
<tr>
<td>10008</td>
<td>system error</td>
<td>其余所有系统上报的异常</td>
</tr>
<tr>
<td>10009</td>
<td>system not support</td>
<td>Android 系统特有，系统版本低于 4.3 不支持BLE</td>
</tr>
</tbody>
</table>

                                
                                </section>
                            
    </div>
    
</div>

                        
</body>
</html>
