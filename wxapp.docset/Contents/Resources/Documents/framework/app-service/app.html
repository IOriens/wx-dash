<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>注册程序</title>
  <link rel="stylesheet" href="../../style.css" />
  <link rel="stylesheet" href="../../website.css" />
  <style type="text/css">
    body {
      padding: 1em;
    }
  </style>
</head>
<body>
  
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="app">App</h1>
<h3 id="app">App()</h3>
<p><code>App()</code> 函数用来注册一个小程序。接受一个 object 参数，其指定小程序的生命周期函数等。</p>
<p><strong>object参数说明：</strong></p>
<table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
<th>触发时机</th>
</tr>
</thead>
<tbody>
<tr>
<td>onLaunch</td>
<td>Function</td>
<td>生命周期函数--监听小程序初始化</td>
<td>当小程序初始化完成时，会触发 onLaunch（全局只触发一次）</td>
</tr>
<tr>
<td>onShow</td>
<td>Function</td>
<td>生命周期函数--监听小程序显示</td>
<td>当小程序启动，或从后台进入前台显示，会触发 onShow</td>
</tr>
<tr>
<td>onHide</td>
<td>Function</td>
<td>生命周期函数--监听小程序隐藏</td>
<td>当小程序从前台进入后台，会触发 onHide</td>
</tr>
<tr>
<td>onError</td>
<td>Function</td>
<td>错误监听函数</td>
<td>当小程序发生脚本错误，或者 api 调用失败时，会触发 onError 并带上错误信息</td>
</tr>
<tr>
<td>onPageNotFound</td>
<td>Function</td>
<td>页面不存在监听函数</td>
<td>当小程序出现要打开的页面不存在的情况，会带上页面信息回调该函数，详见下文</td>
</tr>
<tr>
<td>其他</td>
<td>Any</td>
<td></td>
<td>开发者可以添加任意的函数或数据到 Object 参数中，用 <code>this</code> 可以访问</td>
</tr>
</tbody>
</table>
<p><strong>前台、后台定义：</strong> 当用户点击左上角关闭，或者按了设备 Home 键离开微信，小程序并没有直接销毁，而是进入了后台；当再次进入微信或再次打开小程序，又会从后台进入前台。需要注意的是：只有当小程序进入后台一定时间，或者系统资源占用过高，才会被真正的销毁。</p>
<p>关闭小程序（基础库版本1.1.0开始支持）： 当用户从扫一扫、转发等入口(<a href="scene.html">场景值</a>为1007, 1008, 1011, 1025)进入小程序，且没有置顶小程序的情况下退出，小程序会被销毁。 </p>
<p><strong>小程序运行机制在基础库版本 1.4.0 有所改变：</strong> 上一条关闭逻辑在新版本已不适用。<a href="../operating-mechanism.html">详情</a></p>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-js">App({
  onLaunch: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) </span>{
    <span class="hljs-comment">// Do something initial when launch.</span>
  },
  onShow: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) </span>{
      <span class="hljs-comment">// Do something when show.</span>
  },
  onHide: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-comment">// Do something when hide.</span>
  },
  onError: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg</span>) </span>{
    <span class="hljs-built_in">console</span>.log(msg)
  },
  globalData: <span class="hljs-string">'I am global data'</span>
})
</code></pre>
<h3 id="onlaunch-onshow-参数">onLaunch, onShow 参数</h3>
<table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>path</td>
<td>String</td>
<td>打开小程序的路径</td>
</tr>
<tr>
<td>query</td>
<td>Object</td>
<td>打开小程序的query</td>
</tr>
<tr>
<td>scene</td>
<td>Number</td>
<td>打开小程序的场景值</td>
</tr>
<tr>
<td>shareTicket</td>
<td>String</td>
<td>shareTicket，详见 <a href="../../api/share.html#获取更多转发信息">获取更多转发信息</a></td>
</tr>
<tr>
<td>referrerInfo</td>
<td>Object</td>
<td>当场景为由从另一个小程序或公众号或App打开时，返回此字段</td>
</tr>
<tr>
<td>referrerInfo.appId</td>
<td>String</td>
<td>来源小程序或公众号或App的 appId，详见下方说明</td>
</tr>
<tr>
<td>referrerInfo.extraData</td>
<td>Object</td>
<td>来源小程序传过来的数据，scene=1037或1038时支持</td>
</tr>
</tbody>
</table>
<p>场景值 <a href="scene.html">详见</a>。</p>
<p>以下场景支持返回 referrerInfo.appId：</p>
<table>
<thead>
<tr>
<th>场景值</th>
<th>场景</th>
<th>appId 信息含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>1020</td>
<td>公众号 profile 页相关小程序列表</td>
<td>返回来源公众号 appId</td>
</tr>
<tr>
<td>1035</td>
<td>公众号自定义菜单</td>
<td>返回来源公众号 appId</td>
</tr>
<tr>
<td>1036</td>
<td>App 分享消息卡片</td>
<td>返回来源应用 appId</td>
</tr>
<tr>
<td>1037</td>
<td>小程序打开小程序</td>
<td>返回来源小程序 appId</td>
</tr>
<tr>
<td>1038</td>
<td>从另一个小程序返回</td>
<td>返回来源小程序 appId</td>
</tr>
<tr>
<td>1043</td>
<td>公众号模板消息</td>
<td>返回来源公众号 appId</td>
</tr>
</tbody>
</table>
<h3 id="onpagenotfound">onPageNotFound</h3>
<blockquote>
<p>基础库 1.9.90 开始支持，低版本需做<a href="../compatibility.html">兼容处理</a></p>
</blockquote>
<p>当要打开的页面并不存在时，会回调这个监听器，并带上以下信息：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>path</td>
<td>String</td>
<td>不存在页面的路径</td>
</tr>
<tr>
<td>query</td>
<td>Object</td>
<td>打开不存在页面的 query</td>
</tr>
<tr>
<td>isEntryPage</td>
<td>Boolean</td>
<td>是否本次启动的首个页面（例如从分享等入口进来，首个页面是开发者配置的分享页面）</td>
</tr>
</tbody>
</table>
<p>开发者可以在 <code>onPageNotFound</code> 回调中进行重定向处理，但必须在回调中<strong>同步</strong>处理，异步处理（例如 setTimeout 异步执行）无效。</p>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">App({
  onPageNotFound(res) {
    wx.redirectTo({
      url: <span class="hljs-string">'pages/...'</span>
    })
  }
})
</code></pre>
<p><strong>注意：</strong></p>
<ol>
<li>微信开发者工具暂不支持 <code>onPageNotFound</code> 调试，请使用真机调试</li>
<li>如果开发者没有添加 <code>onPageNotFound</code> 监听，当跳转页面不存在时，将推入微信客户端原生的页面不存在提示页面</li>
<li>如果 <code>onPageNotFound</code> 回调中又重定向到另一个不存在的页面，将推入微信客户端原生的页面不存在提示页面，并且不在回调 <code>onPageNotFound</code></li>
</ol>
<h3 id="getapp">getApp()</h3>
<p>全局的 <code>getApp()</code> 函数可以用来获取到小程序实例。</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// other.js</span>
<span class="hljs-keyword">var</span> appInstance = getApp()
<span class="hljs-built_in">console</span>.log(appInstance.globalData) <span class="hljs-comment">// I am global data</span>
</code></pre>
<p><strong>注意：</strong></p>
<ul>
<li><code>App()</code> 必须在 <code>app.js</code> 中注册，且不能注册多个。</li>
<li>不要在定义于 <code>App()</code> 内的函数中调用 <code>getApp()</code> ，使用 <code>this</code> 就可以拿到 app 实例。</li>
<li>不要在 onLaunch 的时候调用 <code>getCurrentPages()</code>，此时 page 还没有生成。</li>
<li>通过 <code>getApp()</code> 获取实例之后，不要私自调用生命周期函数。</li>
</ul>

                                
                                </section>
                            
    </div>
    
</div>

                        
</body>
</html>
