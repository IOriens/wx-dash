<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Component构造器</title>
  <link rel="stylesheet" href="../../style.css" />
  <link rel="stylesheet" href="../../website.css" />
  <style type="text/css">
    body {
      padding: 1em;
    }
  </style>
</head>
<body>
  
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="component构造器">Component构造器</h1>
<p>Component构造器可用于定义组件，调用Component构造器时可以指定组件的属性、数据、方法等。</p>
<table>
<thead>
<tr>
<th>定义段</th>
<th>类型</th>
<th>是否必填</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>properties</td>
<td>Object Map</td>
<td>否</td>
<td>组件的对外属性，是属性名到属性设置的映射表，属性设置中可包含三个字段， <code>type</code> 表示属性类型、 <code>value</code> 表示属性初始值、 <code>observer</code> 表示属性值被更改时的响应函数</td>
</tr>
<tr>
<td>data</td>
<td>Object</td>
<td>否</td>
<td>组件的内部数据，和 <code>properties</code> 一同用于组件的模版渲染</td>
</tr>
<tr>
<td>methods</td>
<td>Object</td>
<td>否</td>
<td>组件的方法，包括事件响应函数和任意的自定义方法，关于事件响应函数的使用，参见 <a href="events.html">组件事件</a></td>
</tr>
<tr>
<td>behaviors</td>
<td>String Array</td>
<td>否</td>
<td>类似于mixins和traits的组件间代码复用机制，参见 <a href="behaviors.html">behaviors</a></td>
</tr>
<tr>
<td>created</td>
<td>Function</td>
<td>否</td>
<td>组件生命周期函数，在组件实例进入页面节点树时执行，注意此时不能调用 <code>setData</code></td>
</tr>
<tr>
<td>attached</td>
<td>Function</td>
<td>否</td>
<td>组件生命周期函数，在组件实例进入页面节点树时执行</td>
</tr>
<tr>
<td>ready</td>
<td>Function</td>
<td>否</td>
<td>组件生命周期函数，在组件布局完成后执行，此时可以获取节点信息（使用 <a href="../../api/wxml-nodes-info.html">SelectorQuery</a> ）</td>
</tr>
<tr>
<td>moved</td>
<td>Function</td>
<td>否</td>
<td>组件生命周期函数，在组件实例被移动到节点树另一个位置时执行</td>
</tr>
<tr>
<td>detached</td>
<td>Function</td>
<td>否</td>
<td>组件生命周期函数，在组件实例被从页面节点树移除时执行</td>
</tr>
<tr>
<td>relations</td>
<td>Object</td>
<td>否</td>
<td>组件间关系定义，参见 <a href="relations.html">组件间关系</a></td>
</tr>
<tr>
<td>externalClasses</td>
<td>String Array</td>
<td>否</td>
<td>组件接受的外部样式类，参见 <a href="wxml-wxss.html">外部样式类</a></td>
</tr>
<tr>
<td>options</td>
<td>Object Map</td>
<td>否</td>
<td>一些组件选项，请参见文档其他部分的说明</td>
</tr>
</tbody>
</table>
<p>生成的组件实例可以在组件的方法、生命周期函数和属性 <code>observer</code> 中通过 <code>this</code> 访问。组件包含一些通用属性和方法。</p>
<table>
<thead>
<tr>
<th>属性名</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>is</td>
<td>String</td>
<td>组件的文件路径</td>
</tr>
<tr>
<td>id</td>
<td>String</td>
<td>节点id</td>
</tr>
<tr>
<td>dataset</td>
<td>String</td>
<td>节点dataset</td>
</tr>
<tr>
<td>data</td>
<td>Object</td>
<td>组件数据，<strong>包括内部数据和属性值</strong></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>方法名</th>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>setData</td>
<td>Object <code>newData</code></td>
<td>设置data并执行视图层渲染</td>
</tr>
<tr>
<td>hasBehavior</td>
<td>Object <code>behavior</code></td>
<td>检查组件是否具有 <code>behavior</code> （检查时会递归检查被直接或间接引入的所有behavior）</td>
</tr>
<tr>
<td>triggerEvent</td>
<td>String <code>name</code>, Object <code>detail</code>, Object <code>options</code></td>
<td>触发事件，参见 <a href="events.html">组件事件</a></td>
</tr>
<tr>
<td>createSelectorQuery</td>
<td></td>
<td>创建一个 <a href="../../api/wxml-nodes-info.html">SelectorQuery</a> 对象，选择器选取范围为这个组件实例内</td>
</tr>
<tr>
<td>selectComponent</td>
<td>String <code>selector</code></td>
<td>使用选择器选择组件实例节点，返回匹配到的第一个组件实例对象</td>
</tr>
<tr>
<td>selectAllComponents</td>
<td>String <code>selector</code></td>
<td>使用选择器选择组件实例节点，返回匹配到的全部组件实例对象组成的数组</td>
</tr>
<tr>
<td>getRelationNodes</td>
<td>String <code>relationKey</code></td>
<td>获取所有这个关系对应的所有关联节点，参见 <a href="relations.html">组件间关系</a></td>
</tr>
</tbody>
</table>
<p><strong>代码示例：</strong></p>
<pre><code class="lang-js">Component({

  behaviors: [],

  properties: {
    myProperty: { <span class="hljs-comment">// 属性名</span>
      type: <span class="hljs-built_in">String</span>, <span class="hljs-comment">// 类型（必填），目前接受的类型包括：String, Number, Boolean, Object, Array, null（表示任意类型）</span>
      value: <span class="hljs-string">''</span>, <span class="hljs-comment">// 属性初始值（可选），如果未指定则会根据类型选择一个</span>
      observer: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newVal, oldVal</span>)</span>{} <span class="hljs-comment">// 属性被改变时执行的函数（可选），也可以写成在methods段中定义的方法名字符串, 如：'_propertyChange'</span>
    },
    myProperty2: <span class="hljs-built_in">String</span> <span class="hljs-comment">// 简化的定义方式</span>
  },
  data: {}, <span class="hljs-comment">// 私有数据，可用于模版渲染</span>

  <span class="hljs-comment">// 生命周期函数，可以为函数，或一个在methods段中定义的方法名</span>
  attached: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{},
  moved: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{},
  detached: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{},

  methods: {
    onMyButtonTap: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
      <span class="hljs-keyword">this</span>.setData({
        <span class="hljs-comment">// 更新属性和数据的方法与更新页面数据的方法类似</span>
      })
    },
    _myPrivateMethod: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
      <span class="hljs-comment">// 内部方法建议以下划线开头</span>
      <span class="hljs-keyword">this</span>.replaceDataOnPath([<span class="hljs-string">'A'</span>, <span class="hljs-number">0</span>, <span class="hljs-string">'B'</span>], <span class="hljs-string">'myPrivateData'</span>) <span class="hljs-comment">// 这里将 data.A[0].B 设为 'myPrivateData'</span>
      <span class="hljs-keyword">this</span>.applyDataUpdates()
    },
    _propertyChange: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newVal, oldVal</span>) </span>{

    }
  }

})
</code></pre>
<p>注意：在 <code>properties</code> 定义段中，属性名采用驼峰写法（<code>propertyName</code>）；在 <code>wxml</code> 中，指定属性值时则对应使用连字符写法（<code>component-tag-name property-name="attr value"</code>），应用于数据绑定时采用驼峰写法（<code>attr="{{propertyName}}"</code>）。</p>
<p><strong>Tips:</strong></p>
<ul>
<li><code>Component</code> 构造器构造的组件也可以作为页面使用。</li>
<li>使用 <code>this.data</code> 可以获取内部数据和属性值，但不要直接修改它们，应使用 <code>setData</code> 修改。</li>
<li>生命周期函数无法在组件方法中通过 <code>this</code> 访问到。</li>
<li>属性名应避免以 data 开头，即不要命名成 <code>dataXyz</code> 这样的形式，因为在 WXML 中， <code>data-xyz=""</code> 会被作为节点 dataset 来处理，而不是组件属性。</li>
<li>在一个组件的定义和使用时，组件的属性名和data字段相互间都不能冲突（尽管它们位于不同的定义段中）。</li>
</ul>

                                
                                </section>
                            
    </div>
    
</div>

                        
</body>
</html>
