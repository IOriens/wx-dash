<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>转发</title>
  <link rel="stylesheet" href="../style.css" />
  <link rel="stylesheet" href="../website.css" />
  <style type="text/css">
    body {
      padding: 1em;
    }
  </style>
</head>
<body>
  
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="onshareappmessageoptions">onShareAppMessage(options)</h2>
<p>在 Page 中定义 onShareAppMessage 函数，设置该页面的转发信息。</p>
<ul>
<li>只有定义了此事件处理函数，右上角菜单才会显示 “转发” 按钮</li>
<li>用户点击转发按钮的时候会调用</li>
<li>此事件需要 return 一个 Object，用于自定义转发内容</li>
</ul>
<p><strong>options 参数说明</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
<th>最低版本</th>
</tr>
</thead>
<tbody>
<tr>
<td>from</td>
<td>String</td>
<td>转发事件来源。button：页面内转发按钮；menu：右上角转发菜单</td>
<td><a href="../framework/compatibility.html" title="基础库 1.2.4 开始支持，低版本需做兼容处理。">1.2.4</a></td>
</tr>
<tr>
<td>target</td>
<td>Object</td>
<td>如果 from 值是 button，则 target 是触发这次转发事件的 button，否则为 undefined</td>
<td><a href="../framework/compatibility.html" title="基础库 1.2.4 开始支持，低版本需做兼容处理。">1.2.4</a></td>
</tr>
</tbody>
</table>
<p><strong>自定义转发字段</strong></p>
<table>
<thead>
<tr>
<th>字段</th>
<th>说明</th>
<th>默认值</th>
<th>最低版本</th>
</tr>
</thead>
<tbody>
<tr>
<td>title</td>
<td>转发标题</td>
<td>当前小程序名称</td>
<td></td>
</tr>
<tr>
<td>path</td>
<td>转发路径</td>
<td>当前页面 path ，必须是以 / 开头的完整路径</td>
<td></td>
</tr>
<tr>
<td>imageUrl</td>
<td>自定义图片路径，可以是本地文件路径、代码包文件路径或者网络图片路径，支持PNG及JPG，不传入 imageUrl 则使用默认截图。显示图片长宽比是 5:4</td>
<td></td>
<td><a href="../framework/compatibility.html" title="基础库 1.5.0 开始支持，低版本需做兼容处理。">1.5.0</a></td>
</tr>
<tr>
<td>success</td>
<td>转发成功的回调函数</td>
<td></td>
<td><a href="../framework/compatibility.html" title="基础库 1.1.0 开始支持，低版本需做兼容处理。">1.1.0</a></td>
</tr>
<tr>
<td>fail</td>
<td>转发失败的回调函数</td>
<td></td>
<td><a href="../framework/compatibility.html" title="基础库 1.1.0 开始支持，低版本需做兼容处理。">1.1.0</a></td>
</tr>
<tr>
<td>complete</td>
<td>转发结束的回调函数（转发成功、失败都会执行</td>
<td></td>
<td><a href="../framework/compatibility.html" title="基础库 1.1.0 开始支持，低版本需做兼容处理。">1.1.0</a></td>
</tr>
</tbody>
</table>
<p><strong>回调结果：</strong></p>
<table>
<thead>
<tr>
<th>回调类型</th>
<th>errMsg</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>success</td>
<td>shareAppMessage:ok</td>
<td>转发成功</td>
</tr>
<tr>
<td>fail</td>
<td>shareAppMessage:fail cancel</td>
<td>用户取消转发</td>
</tr>
<tr>
<td>fail</td>
<td>shareAppMessage:fail (detail message)</td>
<td>转发失败，其中 detail message 为详细失败信息</td>
</tr>
</tbody>
</table>
<p><strong>success回调参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
<th>最低版本</th>
</tr>
</thead>
<tbody>
<tr>
<td>shareTickets</td>
<td>StringArray</td>
<td>shareTicket 数组，每一项是一个 shareTicket ，对应一个转发对象</td>
<td><a href="../framework/compatibility.html" title="基础库 1.1.0 开始支持，低版本需做兼容处理。">1.1.0</a></td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">Page({
  onShareAppMessage: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
    <span class="hljs-keyword">if</span> (res.from === <span class="hljs-string">'button'</span>) {
      <span class="hljs-comment">// 来自页面内转发按钮</span>
      <span class="hljs-built_in">console</span>.log(res.target)
    }
    <span class="hljs-keyword">return</span> {
      title: <span class="hljs-string">'自定义转发标题'</span>,
      path: <span class="hljs-string">'/page/user?id=123'</span>,
      success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) </span>{
        <span class="hljs-comment">// 转发成功</span>
      },
      fail: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) </span>{
        <span class="hljs-comment">// 转发失败</span>
      }
    }
  }
})
</code></pre>
<h2 id="wxshowsharemenuobject">wx.showShareMenu(OBJECT)</h2>
<blockquote>
<p>基础库 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>显示当前页面的转发按钮</p>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>withShareTicket</td>
<td>Boolean</td>
<td>否</td>
<td>是否使用带 shareTicket 的转发<a href="share.html#获取更多转发信息">详情</a></td>
</tr>
<tr>
<td>success</td>
<td>Function</td>
<td>否</td>
<td>接口调用成功的回调函数</td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">wx.showShareMenu({
  withShareTicket: <span class="hljs-literal">true</span>
})
</code></pre>
<h2 id="wxhidesharemenuobject">wx.hideShareMenu(OBJECT)</h2>
<blockquote>
<p>基础库 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>隐藏转发按钮</p>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>success</td>
<td>Function</td>
<td>否</td>
<td>接口调用成功的回调函数</td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">wx.hideShareMenu()
</code></pre>
<h2 id="wxupdatesharemenuobject">wx.updateShareMenu(OBJECT)</h2>
<blockquote>
<p>基础库 1.2.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>更新转发属性</p>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>withShareTicket</td>
<td>Boolean</td>
<td>否</td>
<td>是否使用带 shareTicket 的转发<a href="share.html#获取更多转发信息">详情</a></td>
</tr>
<tr>
<td>success</td>
<td>Function</td>
<td>否</td>
<td>接口调用成功的回调函数</td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>示例代码：</strong></p>
<pre><code class="lang-javascript">wx.updateShareMenu({
  withShareTicket: <span class="hljs-literal">true</span>,
  success() {
  }
})
</code></pre>
<h2 id="wxgetshareinfoobject">wx.getShareInfo(OBJECT)</h2>
<blockquote>
<p>基础库 1.1.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>获取转发详细信息</p>
<p><strong>OBJECT参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
<th>最低版本</th>
</tr>
</thead>
<tbody>
<tr>
<td>shareTicket</td>
<td>String</td>
<td>是</td>
<td>shareTicket</td>
<td></td>
</tr>
<tr>
<td>timeout</td>
<td>Number</td>
<td>否</td>
<td>超时时间，单位 ms</td>
<td><a href="../framework/compatibility.html" title="基础库 1.9.90 开始支持，低版本需做兼容处理。">1.9.90</a></td>
</tr>
<tr>
<td>success</td>
<td>Function</td>
<td>否</td>
<td>接口调用成功的回调函数</td>
<td></td>
</tr>
<tr>
<td>fail</td>
<td>Function</td>
<td>否</td>
<td>接口调用失败的回调函数</td>
<td></td>
</tr>
<tr>
<td>complete</td>
<td>Function</td>
<td>否</td>
<td>接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody>
</table>
<p><strong>CALLBACK 参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>errMsg</td>
<td>String</td>
<td>错误信息</td>
</tr>
<tr>
<td>encryptedData</td>
<td>String</td>
<td>包括敏感数据在内的完整转发信息的加密数据，详细见<a href="signature.html#加密数据解密算法">加密数据解密算法</a></td>
</tr>
<tr>
<td>iv</td>
<td>String</td>
<td>加密算法的初始向量，详细见<a href="signature.html#加密数据解密算法">加密数据解密算法</a></td>
</tr>
</tbody>
</table>
<p><strong>encryptedData 解密后为一个 JSON 结构，包含字段如下：</strong></p>
<table>
<thead>
<tr>
<th>字段</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>openGId</td>
<td>群对当前小程序的唯一 ID</td>
</tr>
</tbody>
</table>
<p><strong>Tip:</strong> 如需要展示群名称，可以使用<a href="../component/open-data.html">开放数据组件</a></p>
<h2 id="获取更多转发信息">获取更多转发信息</h2>
<p>通常开发者希望转发出去的小程序被二次打开的时候能够获取到一些信息，例如群的标识。现在通过调用 <code>wx.showShareMenu</code> 并且设置 <code>withShareTicket</code> 为 <code>true</code> ，当用户将小程序转发到任一群聊之后，可以获取到此次转发的  <code>shareTicket</code>，此转发卡片在群聊中被其他用户打开时，可以在 <a href="../framework/app-service/app.html">App.onLaunch()</a> 或 <a href="../framework/app-service/app.html">App.onShow</a>  获取到另一个 <code>shareTicket</code>。这两步获取到的 <code>shareTicket</code> 均可通过 <a href="#wxgetshareinfoobject">wx.getShareInfo()</a> 接口可以获取到相同的转发信息。</p>
<h2 id="页面内发起转发">页面内发起转发</h2>
<blockquote>
<p>基础库 1.2.0 开始支持，低版本需做<a href="../framework/compatibility.html">兼容处理</a></p>
</blockquote>
<p>通过给 <code>button</code> 组件设置属性 <code>open-type="share"</code>，可以在用户点击按钮后触发 <code>Page.onShareAppMessage()</code> 事件，如果当前页面没有定义此事件，则点击后无效果。相关组件：<a href="../component/button.html">button</a></p>
<h2 id="使用指引">使用指引</h2>
<p>转发按钮，旨在帮助用户更流畅地与好友分享内容和服务。转发，应是用户自发的行为，且在需要时触手可及。开发者在使用时若遵从以下指引，会得到更佳的用户体验。</p>
<ol>
<li>含义清晰：明确、一目了然的图形按钮，将为用户减少理解的时间。在我们的资源下载中心，你可以找到这样的按钮素材并直接使用。或者你可以根据自己业务的设计风格，灵活设计含义清晰的按钮的样式。当然，你也可以直接使用带文案的按钮，“转发给好友”，它也足够明确。</li>
<li>方便点击：按钮点击热区不宜过小，亦不宜过大。同时，转发按钮与其他按钮一样，热区也不宜过密，以免用户误操作。</li>
<li>按需出现：并非所有页面都适合放置转发按钮，涉及用户隐私的非公开内容，或可能打断用户完成当前操作体验的场景，该功能并不推荐使用。同时，由于转发过程中，我们将截取用户屏幕图像作为配图，因此，需要注意帮助用户屏蔽个人信息。</li>
<li>尊重意愿：理所当然，并非所有的用户，都喜欢与朋友分享你的小程序。因此，它不应该成为一个诱导或强制行为，如转发后才能解锁某项功能等。请注意，这类做法不仅不被推荐，还可能违反我们的<a href="https://mp.weixin.qq.com/debug/wxadoc/product/index.html?t=2018413" target="_blank">《运营规范》</a>，我们强烈建议你在使用前阅读这部分内容。</li>
</ol>
<p>以上，我们陈列了最重要的几点，如果你有时间，可以完整浏览<a href="https://mp.weixin.qq.com/debug/wxadoc/design/index.html?t=2018413" target="_blank">《设计指南》</a>，相信会有更多的收获。</p>
<h4 id="bug--tip">Bug & Tip</h4>
<ol>
<li><code>tip</code>: 不自定义转发图片的情况下，默认会取当前页面，从顶部开始，高度为 80% 屏幕宽度的图像作为转发图片。</li>
<li><code>tip</code>: 转发的调试支持请查看 <a href="../devtools/different.html#普通的转发">普通转发的调试支持</a> 和 <a href="../devtools/different.html#带-shareticket-的转发">带 shareTicket 的转发</a></li>
<li><code>tip</code>: 只有转发到群聊中打开才可以获取到 <code>shareTickets</code> 返回值，单聊没有 <code>shareTickets</code></li>
<li><code>tip</code>: <code>shareTicket</code> 仅在当前小程序生命周期内有效</li>
<li><code>tip</code>: 由于策略变动，小程序群相关能力进行调整，开发者可先使用<code>wx.getShareInfo</code>接口中的群ID进行功能开发。</li>
</ol>

                                
                                </section>
                            
    </div>
    
</div>

                        
</body>
</html>
