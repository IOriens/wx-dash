<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>分包加载</title>
  <link rel="stylesheet" href="../style.css" />
  <link rel="stylesheet" href="../website.css" />
  <style type="text/css">
    body {
      padding: 1em;
    }
  </style>
</head>
<body>
  
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="分包加载">分包加载</h1>
<blockquote>
<p>微信 6.6 客户端，1.7.3 及以上基础库开始支持，请更新至最新客户端版本，开发者工具请使用 1.01.1712150 及以上版本，可<a href="../devtools/download.html">点此下载</a></p>
</blockquote>
<p>某些情况下，开发者需要将小程序划分成不同的子包，在构建时打包成不同的分包，用户在使用时按需进行加载。</p>
<p>在构建小程序分包项目时，构建会输出一个或多个功能的分包，其中每个分包小程序必定含有一个<strong>主包</strong>，所谓的主包，即放置默认启动页面/TabBar 页面，以及一些所有分包都需用到公共资源/JS 脚本，而<strong>分包</strong>则是根据开发者的配置进行划分。</p>
<p>在小程序启动时，默认会下载主包并启动主包内页面，如果用户需要打开分包内某个页面，客户端会把对应分包下载下来，下载完成后再进行展示。</p>
<p>目前小程序分包大小有以下限制：</p>
<ul>
<li>整个小程序所有分包大小不超过 4M</li>
<li>单个分包/主包大小不能超过 2M</li>
</ul>
<p>对小程序进行分包，可以优化小程序首次启动的下载时间，以及在多团队共同开发时可以更好的解耦协作。</p>
<h2 id="使用方法">使用方法</h2>
<p>假设支持分包的小程序目录结构如下：</p>
<pre><code>├── app.js
├── app.json
├── app.wxss
├── packageA
│   └── pages
│       ├── cat
│       └── dog
├── packageB
│   └── pages
│       ├── apple
│       └── banana
├── pages
│   ├── index
│   └── logs
└── utils
</code></pre><p>开发者通过在 app.json <code>subPackages</code> 字段声明项目分包结构：</p>
<pre><code class="lang-json">{
  <span class="hljs-string">"pages"</span>:[
    <span class="hljs-string">"pages/index"</span>,
    <span class="hljs-string">"pages/logs"</span>
  ],
  <span class="hljs-string">"subPackages"</span>: [
    {
      <span class="hljs-string">"root"</span>: <span class="hljs-string">"packageA"</span>,
      <span class="hljs-string">"pages"</span>: [
        <span class="hljs-string">"pages/cat"</span>,
        <span class="hljs-string">"pages/dog"</span>
      ]
    }, {
      <span class="hljs-string">"root"</span>: <span class="hljs-string">"packageB"</span>,
      <span class="hljs-string">"pages"</span>: [
        <span class="hljs-string">"pages/apple"</span>,
        <span class="hljs-string">"pages/banana"</span>
      ]
    }
  ]
}
</code></pre>
<h2 id="打包原则">打包原则</h2>
<ul>
<li>声明 <code>subPackages</code> 后，将按 <code>subPackages</code> 配置路径进行打包，<code>subPackages</code> 配置路径外的目录将被打包到 app（主包） 中</li>
<li>app（主包）也可以有自己的 pages（即最外层的 pages 字段）</li>
<li><code>subPackage</code> 的根目录不能是另外一个 <code>subPackage</code> 内的子目录</li>
<li>首页的 TAB 页面必须在 app（主包）内</li>
</ul>
<h2 id="引用原则">引用原则</h2>
<ul>
<li><code>packageA</code> 无法 require <code>packageB</code> JS 文件，但可以 require <code>app</code>、自己 package 内的 JS 文件</li>
<li><code>packageA</code> 无法 import <code>packageB</code> 的 template，但可以 require <code>app</code>、自己 package 内的 template</li>
<li><code>packageA</code> 无法使用 <code>packageB</code> 的资源，但可以使用 app、自己 package 内的资源</li>
</ul>
<h2 id="低版本兼容">低版本兼容</h2>
<p>由微信后台编译来处理旧版本客户端的兼容，后台会编译两份代码包，一份是分包后代码，另外一份是整包的兼容代码。
新客户端用分包，老客户端还是用的整包，完整包会把各个 subpackage 里面的路径放到 pages 中。</p>
<h2 id="示例项目">示例项目</h2>
<p><a href="../demo/demo-subpackages.zip">下载 小程序示例分包加载版源码</a></p>

                                
                                </section>
                            
    </div>
    
</div>

                        
</body>
</html>
